from flask import Flask, request, abort
from linebot import LineBotApi, WebhookHandler
from linebot.exceptions import InvalidSignatureError
from linebot.models import *
import os
import time
import re
import random

# è®€å–ç’°å¢ƒè®Šæ•¸
LINE_CHANNEL_SECRET = os.getenv('LINE_CHANNEL_SECRET', 'bd376bb55bf19b5866f13f03e4af28ac')
LINE_CHANNEL_ACCESS_TOKEN = os.getenv('LINE_CHANNEL_ACCESS_TOKEN', 'PW2bcRx2rWbuJlWpA8uMCCthgAL6M1XfsmEj5bUsk1KnDBJwGcYWJh+cD5tVaxTwZyuBZYyjQxPrP+b2Yy99LmRRzsPt+UfgIhyMK244uDqWa02wUM51Y9WRzqxD1L+iVYHLPxaEd8T63rlTp5GwhgdB04t89/1O/w1cDnyilFU=+a/FFA+r6n8zeZQFkcFy1uq1qHt/GDVGLHmkClduiOgqksEdUyA7CWST4E+BergVk1A6pTjMZwdB04t89/1O/w1cDnyilFU=')

line_bot_api = LineBotApi(LINE_CHANNEL_ACCESS_TOKEN)
handler = WebhookHandler(LINE_CHANNEL_SECRET)

app = Flask(__name__)

# ä½ çš„ Group ID
GROUP_ID = os.getenv('GROUP_ID', 'Uacca1f2cd08b2f6fcb81626633866a04')

# æ­¡è¿è¨Šæ¯é˜²é‡è¤‡æ§åˆ¶
last_welcome_time = 0
WELCOME_COOLDOWN = 3  # ç§’

# å®Œæ•´è¡Œç¨‹è³‡è¨Šå­—å…¸ï¼ˆåŒ…å«æ‰€æœ‰è¡Œç¨‹å’Œæ™ºèƒ½æ¨è–¦æ¨™ç±¤ï¼‰
ITINERARY_INFO = {
    'C1': {
        'name': 'è³‡ç”Ÿå ‚è·³å³¶ä¸€æ—¥éŠ',
        'type': 'è·³å³¶',
        'duration': 1,
        'difficulty': 'è¼•é¬†',
        'price_range': [2500, 4300],
        'tags': ['è·³å³¶', 'è³‡ç”Ÿå ‚', 'é¦™è•‰èˆ¹', 'æ‹–å‚˜', 'ä¸€æ—¥éŠ', 'æµ·å³¶', 'æ°´ä¸Šæ´»å‹•', 'åˆæ¬¡éŠå®¢', 'ç¶“å…¸'],
        'highlights': ['è³‡ç”Ÿå ‚å³¶', 'é¦™è•‰èˆ¹', 'æ‹–å‚˜', 'å¸¶é­šå…±éŠ'],
        'best_for': ['åˆæ¬¡éŠå®¢', 'æ°´ä¸Šæ´»å‹•æ„›å¥½è€…', 'æƒ³é«”é©—ç¶“å…¸è·³å³¶'],
        'departure': '8:00am',
        'content': """ğŸï¸ ã€C1ã€‘è³‡ç”Ÿå ‚è·³å³¶ä¸€æ—¥éŠ

ğŸ“ è¡Œç¨‹æ™¯é»ï¼š
â€¢ è–æ–‡æ£®ç‰¹è·³å³¶é«”é©—å¸¶é­šå…±éŠ
â€¢ è³‡ç”Ÿå ‚å³¶ä¸Šå³¶
â€¢ ç™½è²é …ç›®
â€¢ é¦™è•‰èˆ¹ 500æŠ«ç´¢/ä½ã€æ‹–å‚˜ 2,500æŠ«ç´¢/ä½

ğŸ½ï¸ åŒ…å«é¤é»ï¼šæ—©é¤ã€åˆé¤ã€é»å¿ƒã€æ™šé…’
â° å‡ºç™¼æ™‚é–“ï¼š8:00am
ğŸ¨ é£¯åº—ï¼šä½å®¿å®‰æ’
âœ¨ å„ªé»ï¼šç¶“å…¸è·³å³¶é«”é©—ï¼Œé©åˆåˆæ¬¡éŠå®¢
ğŸ’° è²»ç”¨ï¼š
â€¢ 4-5äººï½œ4,300æŠ«ç´¢/äºº
â€¢ 6-7äººï½œ3,200æŠ«ç´¢/äºº  
â€¢ 8-9äººï½œ2,700æŠ«ç´¢/äºº
â€¢ 10-13äººï½œ2,500æŠ«ç´¢/äºº"""
    },
    
    'B1': {
        'name': 'è–„è·ä¸€æ—¥éŠ',
        'type': 'è‡ªç„¶æ™¯è§€',
        'duration': 1,
        'difficulty': 'è¼•é¬†',
        'price_range': [4200, 5600],
        'tags': ['è–„è·å³¶', 'å·§å…‹åŠ›å±±', 'çœ¼é¡çŒ´', 'äººé€ æ—', 'éŠæ²³', 'ç©ºä¸­é£›äºº', 'è¶Šé‡è»Š', 'ä¸€æ—¥éŠ', 'é™¸åœ°éŠ'],
        'highlights': ['å·§å…‹åŠ›å±±', 'çœ¼é¡çŒ´', 'ç©ºä¸­é£›äºº', 'è¶Šé‡è»Š'],
        'best_for': ['å–œæ­¡è‡ªç„¶æ™¯è§€', 'æƒ³çœ‹å¯æ„›å‹•ç‰©', 'å–œæ­¡é™¸åœ°æ´»å‹•'],
        'departure': '06:00am',
        'content': """ğŸŒŠ ã€B1ã€‘è–„è·ä¸€æ—¥éŠ

ğŸ“ è¡Œç¨‹æ™¯é»ï¼š
â€¢ è–„è·å³¶é™¸åœ°éŠï¼ˆå°ˆé–€åœ¨è–„è·å³¶ï¼‰
â€¢ å·§å…‹åŠ›å±±ã€çœ¼é¡çŒ´ã€äººé€ æ—ã€éŠæ²³èˆ¹é¤
â€¢ ç©ºä¸­é£›äºº+700/ä½
â€¢ æ¦›åœ‹è¶Šé‡è»Š+1400php/ä½ï¼ˆä¸€å°æ™‚ï¼‰

ğŸ½ï¸ åŒ…å«é¤é»ï¼šåˆé¤
â° å‡ºç™¼æ™‚é–“ï¼š06:00am
âœ¨ å„ªé»ï¼šè–„è·å³¶æ·±åº¦é«”é©—
ğŸ’° è²»ç”¨ï¼š
â€¢ 4-5äººï½œ5600æŠ«ç´¢/äºº
â€¢ 6-7äººï½œ4900æŠ«ç´¢/äºº
â€¢ 8-9äººï½œ4500æŠ«ç´¢/äºº
â€¢ 10-13äººï½œ4,200æŠ«ç´¢/äºº"""
    },
    
    'S8': {
        'name': 'å¢¨å¯¶ä¸€æ—¥éŠ',
        'type': 'æµ·æ´‹ç”Ÿç‰©',
        'duration': 1,
        'difficulty': 'è¼•é¬†',
        'price_range': [2200, 4500],
        'tags': ['å¢¨å¯¶', 'æ²™ä¸é­š', 'æµ®æ½›', 'æµ·ç˜', 'ä¸€æ—¥éŠ', 'æµ·æ´‹', 'æ½›æ°´'],
        'highlights': ['æ²™ä¸é­šé¢¨æš´', 'å¢¨å¯¶ç™½æ²™ç˜', 'æµ®æ½›'],
        'best_for': ['æƒ³çœ‹æ²™ä¸é­š', 'å–œæ­¡æµ®æ½›', 'é ç®—å‹å¥½'],
        'departure': '06:00am',
        'content': """ğŸ–ï¸ ã€S8ã€‘å¢¨å¯¶ä¸€æ—¥éŠ

ğŸ“ è¡Œç¨‹æ™¯é»ï¼š
â€¢ å¢¨å¯¶æ²™ä¸é­šé¢¨æš´ã€å¢¨å¯¶ White Beach

ğŸ½ï¸ åŒ…å«é¤é»ï¼šæ—©é¤ã€åˆé¤
â° å‡ºç™¼æ™‚é–“ï¼š06:00am
âœ¨ å„ªé»ï¼šæ¬£è³å£¯è§€æ²™ä¸é­šç¾¤
ğŸ’° è²»ç”¨ï¼š
â€¢ 4-5äººï½œ4,500æŠ«ç´¢/äºº
â€¢ 6-7äººï½œ3,300æŠ«ç´¢/äºº
â€¢ 8-9äººï½œ2,600æŠ«ç´¢/äºº
â€¢ 10-13äººï½œ2,200æŠ«ç´¢/äºº"""
    },
    
    'S2': {
        'name': 'æœ”æºªä¸€æ—¥éŠ',
        'type': 'å†’éšªæ´»å‹•',
        'duration': 1,
        'difficulty': 'åˆºæ¿€',
        'price_range': [3800, 5800],
        'tags': ['æœ”æºª', 'å˜‰è¯å±±', 'kawasan', 'alegria', 'å†’éšª', 'åˆºæ¿€', 'ä¸€æ—¥éŠ', 'ç€‘å¸ƒ', 'è·³æ°´'],
        'highlights': ['å…¨ç¨‹æœ”æºª', 'ç€‘å¸ƒè·³æ°´', 'åˆºæ¿€å†’éšª'],
        'best_for': ['å–œæ­¡åˆºæ¿€å†’éšª', 'é«”åŠ›å……æ²›', 'æƒ³æŒ‘æˆ°è‡ªå·±'],
        'departure': '06:00am',
        'content': """ğŸŠâ€â™€ï¸ ã€S2ã€‘æœ”æºªä¸€æ—¥éŠ

ğŸ“ è¡Œç¨‹æ™¯é»ï¼š
â€¢ å˜‰è¯å±±Kawasan å…¨ç¨‹æœ”æºªï¼ˆ4-5å°æ™‚ï¼‰
â€¢ Or Alegria å…¨ç¨‹æœ”æºªï¼ˆ4-5å°æ™‚ï¼‰

ğŸ½ï¸ åŒ…å«é¤é»ï¼šæ—©é¤ã€åˆé¤
â° å‡ºç™¼æ™‚é–“ï¼š06:00am
âœ¨ å„ªé»ï¼šåˆºæ¿€å†’éšªé«”é©—
ğŸ’° è²»ç”¨ï¼š
â€¢ 4-5äººï½œ5,800æŠ«ç´¢/äºº
â€¢ 6-7äººï½œ4,600æŠ«ç´¢/äºº
â€¢ 8-9äººï½œ4,100æŠ«ç´¢/äºº
â€¢ 10-13äººï½œ3,800æŠ«ç´¢/äºº"""
    },
    
    'S3': {
        'name': 'å¢¨å¯¶&æœ”æºªä¸€æ—¥éŠ',
        'type': 'çµ„åˆæ´»å‹•',
        'duration': 1,
        'difficulty': 'ä¸­ç­‰',
        'price_range': [4600, 6600],
        'tags': ['å¢¨å¯¶', 'æœ”æºª', 'æ²™ä¸é­š', 'å†’éšª', 'ä¸€æ—¥éŠ', 'æµ·æ´‹', 'ç€‘å¸ƒ', 'çµ„åˆ'],
        'highlights': ['æ²™ä¸é­šé¢¨æš´', 'Kawasanæœ”æºª', 'æµ·æ´‹ç€‘å¸ƒé›™é«”é©—'],
        'best_for': ['æƒ³è¦å¤šé‡é«”é©—', 'æ™‚é–“æœ‰é™', 'å–œæ­¡è±å¯Œè¡Œç¨‹'],
        'departure': '06:00am',
        'content': """ğŸŒ… ã€S3ã€‘å¢¨å¯¶&æœ”æºªä¸€æ—¥éŠ

ğŸ“ è¡Œç¨‹æ™¯é»ï¼š
â€¢ å¢¨å¯¶æ²™ä¸é­šé¢¨æš´ã€å¢¨å¯¶White Beach
â€¢ Kawasan æœ”æºª

ğŸ½ï¸ åŒ…å«é¤é»ï¼šæ—©é¤ã€åˆé¤ã€æ™šé¤
â° å‡ºç™¼æ™‚é–“ï¼š06:00am
âœ¨ å„ªé»ï¼šçµåˆæµ·æ´‹èˆ‡æºªæµé«”é©—
ğŸ’° è²»ç”¨ï¼š
â€¢ 4-5äººï½œ6,600æŠ«ç´¢/äºº
â€¢ 6-7äººï½œ5,500æŠ«ç´¢/äºº
â€¢ 8-9äººï½œ4,900æŠ«ç´¢/äºº
â€¢ 10-13äººï½œ4,600æŠ«ç´¢/äºº"""
    },
    
    'C2': {
        'name': 'å¸‚å€ä¸€æ—¥éŠ',
        'type': 'æ–‡åŒ–æ­·å²',
        'duration': 1,
        'difficulty': 'è¼•é¬†',
        'price_range': [1600, 3400],
        'tags': ['å¸‚å€', 'æ–‡åŒ–', 'æ­·å²', 'æ•™å ‚', 'è¼•é¬†', 'ä¸€æ—¥éŠ', 'å¤œæ™¯', 'ä¾¿å®œ'],
        'highlights': ['è–å¬°æ•™å ‚', 'éº¥å“²å€«åå­—æ¶', 'Topså¤œæ™¯'],
        'best_for': ['å–œæ­¡æ–‡åŒ–æ­·å²', 'é ç®—æœ‰é™', 'æƒ³çœ‹å¤œæ™¯'],
        'departure': '13:00pm',
        'content': """ğŸ›ï¸ ã€C2ã€‘å¸‚å€ä¸€æ—¥éŠ

ğŸ“ è¡Œç¨‹æ™¯é»ï¼š
â€¢ è–å¬°æ•™å ‚ã€éº¥å“²å€«åå­—æ¶ã€è–ä½©ç‰¹ç¾…å ¡
â€¢ è‰é›…ç¥å»Ÿã€å¸Œé›…èŠ±åœ’
â€¢ æ™šé¤å¯é å®šTopså¤œæ™¯é¤å»³

ğŸ½ï¸ åŒ…å«é¤é»ï¼šä¸å«é¤
â° å‡ºç™¼æ™‚é–“ï¼š13:00pm
âœ¨ å„ªé»ï¼šæ–‡åŒ–æ­·å²æ·±åº¦éŠ
ğŸ’° è²»ç”¨ï¼š
â€¢ 4-5äººï½œ3,400æŠ«ç´¢/äºº
â€¢ 6-7äººï½œ2,300æŠ«ç´¢/äºº
â€¢ 8-9äººï½œ1,900æŠ«ç´¢/äºº
â€¢ 10-13äººï½œ1,600æŠ«ç´¢/äºº"""
    },
    
    'N1': {
        'name': 'å–„å¦®å³¶ä¸€æ—¥éŠ',
        'type': 'å°å³¶æ¢éšª',
        'duration': 1,
        'difficulty': 'ä¸­ç­‰',
        'price_range': [3500, 5600],
        'tags': ['å–„å¦®å³¶', 'çŸ³æ´', 'ç¨æœ¨èˆŸ', 'æ‡¸å´–è·³æ°´', 'è‡ªç„¶', 'ä¸€æ—¥éŠ', 'å°å³¶'],
        'highlights': ['é‘½æ´çŸ³æ´', 'ç¨æœ¨èˆŸéŠæ¹–', 'æ‡¸å´–è·³æ°´'],
        'best_for': ['å–œæ­¡æ¢éšª', 'æƒ³é«”é©—ç¨æœ¨èˆŸ', 'ä¸æ€•è·³æ°´'],
        'departure': '06:00am',
        'content': """ğŸŒº ã€N1ã€‘å–„å¦®å³¶ä¸€æ—¥éŠ

ğŸ“ è¡Œç¨‹æ™¯é»ï¼š
â€¢ é‘½æ´çŸ³æ´ã€ç¨æœ¨èˆŸéŠæ¹–ã€æ‡¸å´–è·³æ°´

ğŸ½ï¸ åŒ…å«é¤é»ï¼šæ—©é¤ã€åˆé¤
â° å‡ºç™¼æ™‚é–“ï¼š06:00am
âœ¨ å„ªé»ï¼šåŸå§‹è‡ªç„¶é¢¨å…‰
ğŸ’° è²»ç”¨ï¼š
â€¢ 4-5äººï½œ5,600æŠ«ç´¢/äºº
â€¢ 6-7äººï½œ4,500æŠ«ç´¢/äºº
â€¢ 8-9äººï½œ3,900æŠ«ç´¢/äºº
â€¢ 10-13äººï½œ3,500æŠ«ç´¢/äºº"""
    },
    
    'S1': {
        'name': 'å®¿éœ§é¯¨é¯Šå…©æ—¥éŠ',
        'type': 'æµ·æ´‹ç”Ÿç‰©',
        'duration': 2,
        'difficulty': 'ä¸­ç­‰',
        'price_range': [7750, 10050],
        'tags': ['é¯¨é¯Š', 'æ­æ–¯é™¸', 'oslob', 'å¢¨å¯¶', 'æœ”æºª', 'å…©æ—¥éŠ', 'ç†±é–€', 'åˆºæ¿€', 'æµ®æ½›', 'æ»‘ç´¢'],
        'highlights': ['é¯¨é¯Šå…±æ¸¸', 'æ²™ä¸é­šé¢¨æš´', 'å…¨ç¨‹æœ”æºª', 'é«˜ç©ºæ»‘ç´¢'],
        'best_for': ['æƒ³çœ‹é¯¨é¯Š', 'å–œæ­¡åˆºæ¿€å†’éšª', 'æ™‚é–“å……è£•'],
        'departure': '6:00AM',
        'content': """ğŸŒŠ ã€S1ã€‘å®¿éœ§é¯¨é¯Šå…©æ—¥éŠè¡Œç¨‹

ğŸ“ è¡Œç¨‹æ™¯é»/æ´»å‹•ï¼š
â€¢ æ­æ–¯é™¸é¯¨é¯Šæµ®æ½› Oslob
â€¢ å¢¨å¯¶æ²™ä¸é­šæµ®æ½› Moalboal
â€¢ å˜‰è¯å±±å…¨ç¨‹æœ”æºª Kawasanï¼ˆ4-5å°æ™‚ï¼‰
â€¢ å˜‰è¯å±±é«˜ç©ºæ»‘ç´¢ +600 php

ğŸ½ï¸ åŒ…å«é¤é»ï¼šå…©æ—¥æ—©é¤ã€å…©æ—¥åˆé¤ã€é¦–æ—¥æ™šé¤
â° ç¬¬ä¸€å¤©è¡Œç¨‹å‡ºç™¼æ™‚é–“ï¼š6:00AM
ğŸ¨ é£¯åº—ï¼šBabylon Guest House Oslob New Village Luna Guest House (ä½æ­æ–¯é™¸)
âœ¨ å„ªé»ï¼šè¡Œç¨‹æœ€åˆºæ¿€ã€ç†±é–€é¦–é¸ã€é¦–æ—¥å‡ºç™¼æ™‚é–“è¼ƒæ™š
ğŸ’° è²»ç”¨ï¼š
â€¢ 4-5äººï½œ10,050æŠ«ç´¢/äºº
â€¢ 6-7äººï½œ8,750æŠ«ç´¢/äºº
â€¢ 8-9äººï½œ8,050æŠ«ç´¢/äºº
â€¢ 10-13äººï½œ7,750æŠ«ç´¢/äºº"""
    },
    
    'S1A': {
        'name': 'å®¿éœ§é¯¨é¯Šå…©æ—¥éŠï¼ˆåŠç¨‹æœ”æºªï¼‰',
        'type': 'æµ·æ´‹ç”Ÿç‰©',
        'duration': 2,
        'difficulty': 'è¼•é¬†',
        'price_range': [6600, 9300],
        'tags': ['é¯¨é¯Š', 'æ­æ–¯é™¸', 'oslob', 'å¢¨å¯¶', 'æœ”æºª', 'å…©æ—¥éŠ', 'è¼•é¬†', 'alegria', 'åŠç¨‹'],
        'highlights': ['é¯¨é¯Šå…±æ¸¸', 'æ²™ä¸é­šæµ®æ½›', 'åŠç¨‹æœ”æºª'],
        'best_for': ['æƒ³çœ‹é¯¨é¯Šä½†ä¸è¦å¤ªç´¯', 'æ™‚é–“å……è£•', 'åˆæ¬¡æœ”æºª'],
        'departure': '6:00AM',
        'content': """ğŸ‹ ã€S1Aã€‘å®¿éœ§é¯¨é¯Šå…©æ—¥éŠè¡Œç¨‹

ğŸ“ è¡Œç¨‹æ™¯é»/æ´»å‹•ï¼š
â€¢ æ­æ–¯é™¸é¯¨é¯Šæµ®æ½› Oslob
â€¢ å¢¨å¯¶æ²™ä¸é­šæµ®æ½› Moalboal
â€¢ AlegriaåŠç¨‹æœ”æºªï¼ˆåŠç¨‹2å°æ™‚ï¼‰

ğŸ½ï¸ åŒ…å«é¤é»ï¼šå…©æ—¥æ—©é¤ã€å…©æ—¥åˆé¤
â° ç¬¬ä¸€å¤©è¡Œç¨‹å‡ºç™¼æ™‚é–“ï¼š6:00AM
ğŸ¨ é£¯åº—ï¼šBabylon Guest House Oslob New Village Luna Guest House (ä½æ­æ–¯é™¸)
âœ¨ å„ªé»ï¼šAlegriaåŠç¨‹æœ”æºªæ¯”è¼ƒä¸ç´¯ã€é¦–æ—¥å‡ºç™¼æ™‚é–“è¼ƒæ™š
ğŸ’° è²»ç”¨ï¼š
â€¢ 4-5äººï½œ9,300æŠ«ç´¢/äºº
â€¢ 6-7äººï½œ7,600æŠ«ç´¢/äºº
â€¢ 8-9äººï½œ6,900æŠ«ç´¢/äºº
â€¢ 10-13äººï½œ6,600æŠ«ç´¢/äºº"""
    },
    
    'SS1B': {
        'name': 'å®¿éœ§é¯¨é¯Šå…©æ—¥éŠï¼ˆSS1Bç‰ˆï¼‰',
        'type': 'æµ·æ´‹ç”Ÿç‰©',
        'duration': 2,
        'difficulty': 'è¼•é¬†',
        'price_range': [6600, 9300],
        'tags': ['é¯¨é¯Š', 'æ­æ–¯é™¸', 'oslob', 'å¢¨å¯¶', 'æœ”æºª', 'å…©æ—¥éŠ', 'è¼•é¬†', 'alegria'],
        'highlights': ['é¯¨é¯Šå…±æ¸¸', 'æ²™ä¸é­šæµ®æ½›', 'åŠç¨‹æœ”æºª'],
        'best_for': ['æƒ³çœ‹é¯¨é¯Šä½†ä¸è¦å¤ªç´¯', 'æ™‚é–“å……è£•', 'åˆæ¬¡æœ”æºª'],
        'departure': '6:00AM',
        'content': """ğŸŒŠ ã€SS1Bã€‘å®¿éœ§é¯¨é¯Šå…©æ—¥éŠè¡Œç¨‹

ğŸ“ è¡Œç¨‹æ™¯é»/æ´»å‹•ï¼š
â€¢ æ­æ–¯é™¸é¯¨é¯Šæµ®æ½› Oslob
â€¢ å¢¨å¯¶æ²™ä¸é­š Moalboal
â€¢ AlegriaåŠç¨‹æœ”æºªï¼ˆåŠç¨‹2å°æ™‚ï¼‰

ğŸ½ï¸ åŒ…å«é¤é»ï¼šå…©æ—¥æ—©é¤ã€å…©æ—¥åˆé¤
â° ç¬¬ä¸€å¤©è¡Œç¨‹å‡ºç™¼æ™‚é–“ï¼š6:00AM
ğŸ¨ é£¯åº—ï¼šBabylon Guest House Oslob New Village Luna Guest House (ä½æ­æ–¯é™¸)
âœ¨ å„ªé»ï¼šAlegriaåŠç¨‹æœ”æºªæ¯”è¼ƒä¸ç´¯
ğŸ’° è²»ç”¨ï¼š
â€¢ 4-5äººï½œ9,300æŠ«ç´¢/äºº
â€¢ 6-7äººï½œ7,600æŠ«ç´¢/äºº
â€¢ 8-9äººï½œ6,900æŠ«ç´¢/äºº
â€¢ 10-13äººï½œ6,600æŠ«ç´¢/äºº"""
    },
    
    'S1-1B': {
        'name': 'å®¿éœ§é¯¨é¯Šå…©æ—¥éŠï¼ˆç„¡æœ”æºªç‰ˆï¼‰',
        'type': 'æµ·æ´‹ç”Ÿç‰©',
        'duration': 2,
        'difficulty': 'è¼•é¬†',
        'price_range': [6300, 9700],
        'tags': ['é¯¨é¯Š', 'æ­æ–¯é™¸', 'oslob', 'å¢¨å¯¶', 'è˜‡ç±³é¾å³¶', 'ç€‘å¸ƒ', 'å…©æ—¥éŠ', 'è¼•é¬†', 'ä¾¿å®œ'],
        'highlights': ['é¯¨é¯Šå…±æ¸¸', 'è˜‡ç±³é¾å³¶', 'åœ–é¦¬æ´›ç€‘å¸ƒ', 'æ²™ä¸é­šæµ®æ½›'],
        'best_for': ['æƒ³çœ‹é¯¨é¯Š', 'ä¸æƒ³æœ”æºª', 'å–œæ­¡è¼•é¬†è¡Œç¨‹'],
        'departure': '6:00AM',
        'content': """ğŸï¸ ã€S1-1Bã€‘å®¿éœ§é¯¨é¯Šå…©æ—¥éŠè¡Œç¨‹

ğŸ“ è¡Œç¨‹æ™¯é»/æ´»å‹•ï¼š
â€¢ æ­æ–¯é™¸é¯¨é¯Šæµ®æ½› Oslob
â€¢ è˜‡ç±³é¾å³¶ Sumilon Island
â€¢ åœ–é¦¬æ´›ç€‘å¸ƒ Tumalog Falls
â€¢ å¢¨å¯¶æ²™ä¸é­šæµ®æ½› Moalboal
â€¢ è©²è¡Œç¨‹ç„¡æœ”æºª

ğŸ½ï¸ åŒ…å«é¤é»ï¼šå…©æ—¥æ—©é¤ã€å…©æ—¥åˆé¤
â° ç¬¬ä¸€å¤©è¡Œç¨‹å‡ºç™¼æ™‚é–“ï¼š6:00AM
ğŸ¨ é£¯åº—ï¼šBabylon Guest House Oslob New Village Luna Guest House (ä½æ­æ–¯é™¸)
âœ¨ å„ªé»ï¼šåƒ¹æ ¼è¼ƒä¾¿å®œã€è¡Œç¨‹è¼ƒè¼•é¬†
ğŸ’° è²»ç”¨ï¼š
â€¢ 4-5äººï½œ9,700æŠ«ç´¢/äºº
â€¢ 6-7äººï½œ7,800æŠ«ç´¢/äºº
â€¢ 8-9äººï½œ6,900æŠ«ç´¢/äºº
â€¢ 10-13äººï½œ6,300æŠ«ç´¢/äºº"""
    },
    
    'B2': {
        'name': 'è–„è·å³¶å…©æ—¥éŠ',
        'type': 'è‡ªç„¶æ™¯è§€',
        'duration': 2,
        'difficulty': 'è¼•é¬†',
        'price_range': [7400, 11350],
        'tags': ['è–„è·å³¶', 'å·§å…‹åŠ›å±±', 'çœ¼é¡çŒ´', 'å·´é‡Œå¡è–©å³¶', 'è™•å¥³å³¶', 'å…©æ—¥éŠ', 'ç†±é–€', 'ç©ºä¸­é£›äºº'],
        'highlights': ['å·§å…‹åŠ›å±±', 'çœ¼é¡çŒ´', 'å·´é‡Œå¡è–©å³¶', 'è™•å¥³å³¶'],
        'best_for': ['å–œæ­¡è‡ªç„¶æ™¯è§€', 'æƒ³çœ‹è–„è·å³¶å…¨è²Œ', 'æ™‚é–“å……è£•'],
        'departure': '6:00am',
        'content': """ğŸï¸ ã€B2ã€‘è–„è·å³¶å…©æ—¥éŠ

ğŸ“ è¡Œç¨‹æ™¯é»ï¼š
â€¢ å·§å…‹åŠ›å±±ã€çœ¼é¡çŒ´ã€éŠæ²³èˆ¹é¤
â€¢ å·´é‡Œå¡è–©å³¶ã€è™•å¥³å³¶
â€¢ ç©ºä¸­é£›äºº+700/ä½ï¼ˆè‡ªè²»ï¼‰
â€¢ æ¥µé™è¶Šé‡è»Š+1400php/ä½ï¼ˆè‡ªè²»ï¼‰

ğŸ½ï¸ åŒ…å«é¤é»ï¼šå…©æ—¥æ—©é¤ã€å…©æ—¥åˆé¤
â° ç¬¬ä¸€å¤©è¡Œç¨‹å‡ºç™¼æ™‚é–“ï¼š6:00am
ğŸ¨ é£¯åº—ï¼šBouna Vita Resort Green Mango Resort
âœ¨ å„ªé»ï¼šè¡Œç¨‹ç†±é–€é¦–é¸ã€å…©æ—¥ç©å®Œè–„è·å³¶ç¶“å…¸è¡Œç¨‹
ğŸ’° è²»ç”¨ï¼š
â€¢ 4-5äººï½œ11,350æŠ«ç´¢/äºº
â€¢ 6-7äººï½œ9,150æŠ«ç´¢/äºº
â€¢ 8-9äººï½œ8,050æŠ«ç´¢/äºº
â€¢ 10-13äººï½œ7,400æŠ«ç´¢/äºº"""
    },
    
    'N2': {
        'name': 'å–„å¦®å³¶å…©æ—¥éŠ',
        'type': 'å°å³¶æ¢éšª',
        'duration': 2,
        'difficulty': 'ä¸­ç­‰',
        'price_range': [6000, 9100],
        'tags': ['å–„å¦®å³¶', 'ç´”æ¨¸', 'åº¦å‡', 'å°å³¶', 'çŸ³æ´', 'ç¨æœ¨èˆŸ', 'æ‡¸å´–è·³æ°´', 'æ»‘ç´¢', 'å…©æ—¥éŠ'],
        'highlights': ['é‘½å­”çŸ³æ´', 'ç¨æœ¨èˆŸéŠæ¹–', 'æ‡¸å´–è·³æ°´', 'é«˜ç©ºæ»‘ç´¢'],
        'best_for': ['å–œæ­¡ç´”æ¨¸å°å³¶', 'æƒ³æ·±åº¦åº¦å‡', 'å–œæ­¡å†’éšªæ´»å‹•'],
        'departure': '06:00am',
        'content': """ğŸŒº ã€N2ã€‘å–„å¦®å³¶å…©æ—¥éŠ

ğŸ“ è¡Œç¨‹æ™¯é»ï¼š
â€¢ é‘½å­”çŸ³æ´ã€ç¨æœ¨èˆŸéŠæ¹–ã€æ‡¸å´–è·³æ°´
â€¢ é«˜ç©ºæ»‘ç´¢+300phpï¼ˆè‡ªè²»ï¼‰
â€¢ Tulang island +500phpï¼ˆè‡ªè²»ï¼‰

ğŸ½ï¸ åŒ…å«é¤é»ï¼šå…©æ—¥æ—©é¤ã€å…©æ—¥åˆé¤ã€é¦–æ—¥æ™šé¤
â° ç¬¬ä¸€å¤©è¡Œç¨‹å‡ºç™¼æ™‚é–“ï¼š06:00am
ğŸ¨ é£¯åº—ï¼šOcean heaven resort
âœ¨ å„ªé»ï¼šéå¸¸å¯æ„›çš„ç´”æ¨¸å°å³¶ã€å°ç·¨ç§æˆ¿åº¦å‡é¦–é¸
ğŸ’° è²»ç”¨ï¼š
â€¢ 4-5äººï½œ9,100æŠ«ç´¢/äºº
â€¢ 6-7äººï½œ7,400æŠ«ç´¢/äºº
â€¢ 8-9äººï½œ6,500æŠ«ç´¢/äºº
â€¢ 10-13äººï½œ6,000æŠ«ç´¢/äºº"""
    },
    
    'N3': {
        'name': 'åª½åª½å³¶å…©æ—¥éŠ',
        'type': 'ç¶²ç¾æ™¯é»',
        'duration': 2,
        'difficulty': 'ä¸­ç­‰',
        'price_range': [6800, 12900],
        'tags': ['åª½åª½å³¶', 'æ²™æ´²', 'kalaggaman', 'ç¶²ç¾', 'æ‹ç…§', 'ç™½æ²™', 'æ½›æ°´', 'é•·å°¾é¯Š', 'å…©æ—¥éŠ'],
        'highlights': ['Kalaggamanç™½æ²™æ´²', 'çµ•ç¾æ²™æ´²', 'æ½›æ°´çœ‹é•·å°¾é¯Š'],
        'best_for': ['æƒ³æ‹ç¶²ç¾ç…§', 'å–œæ­¡ç´”æ·¨æ²™æ´²', 'æœ‰æ½›æ°´è­‰'],
        'departure': '3:00am',
        'content': """ğŸ–ï¸ ã€N3ã€‘åª½åª½å³¶å…©æ—¥éŠ

ğŸ“ è¡Œç¨‹æ™¯é»ï¼š
â€¢ Kalaggaman æ²™æ´²
â€¢ åª½åª½å³¶æ‘©æ‰˜ç’°å³¶
â€¢ åª½åª½å³¶è·³å³¶ +500php/ä½ï¼ˆè‡ªè²»ï¼‰

ğŸ½ï¸ åŒ…å«é¤é»ï¼šå…©æ—¥æ—©é¤ã€å…©æ—¥åˆé¤
â° ç¬¬ä¸€å¤©è¡Œç¨‹å‡ºç™¼æ™‚é–“ï¼š3:00am
ğŸ¨ é£¯åº—ï¼šSlam's Garden Dive Resort
âœ¨ å„ªé»ï¼šé©åˆæƒ³æ‹ç¶²ç¾ç…§çš„å®¢äººã€å°ç·¨å¿ƒä¸­ No.1 ç™½æ²™æ´² Kalaggaman çµ•ç¾å¾®æ™¯é»ã€æœ‰æ½›æ°´è­‰æƒ³çœ‹é•·å°¾é¯Šå¿…é¸ï¼ˆ5,800php ä¸‰æ½›ï¼‰
ğŸ’° è²»ç”¨ï¼š
â€¢ 4-5äººï½œ12,900æŠ«ç´¢/äºº
â€¢ 6-7äººï½œ9,300æŠ«ç´¢/äºº
â€¢ 8-9äººï½œ7,800æŠ«ç´¢/äºº
â€¢ 10-13äººï½œ6,800æŠ«ç´¢/äºº"""
    },
    
    'N4': {
        'name': 'ç­å¡”å²©å…©æ—¥éŠ',
        'type': 'ç¶²ç¾æ™¯é»',
        'duration': 2,
        'difficulty': 'ä¸­ç­‰',
        'price_range': [6700, 8300],
        'tags': ['ç­å¡”å²©', 'é­”å¥³å³¶', 'æµ·ç˜', 'æ½Ÿæ¹–', 'è·³å‚˜', 'é¢¨å¸†', 'ç¶²ç¾', 'æ‹ç…§', 'å…©æ—¥éŠ', 'kota beach'],
        'highlights': ['ç­å¡”å²©é­”å¥³å³¶', 'Kota Beach', 'æ½Ÿæ¹–æ²™ç˜', 'æ¥µé™è·³å‚˜'],
        'best_for': ['æƒ³æ‹ç¶²ç¾ç…§', 'å–œæ­¡ç¾éº—æµ·ç˜', 'æƒ³é«”é©—è·³å‚˜'],
        'departure': '4:00am',
        'content': """ğŸŒŠ ã€N4ã€‘ç­å¡”å²©å…©æ—¥éŠ

ğŸ“ è¡Œç¨‹æ™¯é»ï¼š
â€¢ ç­å¡”å²©é­”å¥³å³¶è·³å³¶
â€¢ çµ•ç¾ç´šæµ·ç˜
â€¢ æ½Ÿæ¹–æ²™ç˜ Balidbid Lagoon +450php/ä½
â€¢ æ¥µé™è·³å‚˜ +24,500php/ä½ï¼ˆè‡ªè²»ï¼‰
â€¢ å¤•é™½é¢¨å¸† + 1300php/ä½

ğŸ½ï¸ åŒ…å«é¤é»ï¼šå…©æ—¥æ—©é¤ã€å…©æ—¥åˆé¤
â° ç¬¬ä¸€å¤©è¡Œç¨‹å‡ºç™¼æ™‚é–“ï¼š4:00am
ğŸ¨ é£¯åº—ï¼šTeza Resort
âœ¨ å„ªé»ï¼šé©åˆæƒ³æ‹ç¶²ç¾ç…§çš„å®¢äººã€å®¿éœ§ No.1 æµ·ç˜ Kota Beachã€æƒ³é«”é©—ä¸åŒè§’åº¦çœ‹å®¿éœ§ã€æ¥µé™è·³å‚˜æ´»å‹•ï¼ˆè‡ªè²»ï¼‰
ğŸ’° è²»ç”¨ï¼š
â€¢ 6-7äººï½œ8,300æŠ«ç´¢/äºº
â€¢ 8-9äººï½œ7,500æŠ«ç´¢/äºº
â€¢ 10-13äººï½œ6,700æŠ«ç´¢/äºº"""
    },
    
    'S4': {
        'name': 'é¯¨é¯Šä¸€æ—¥éŠ',
        'type': 'æµ·æ´‹ç”Ÿç‰©',
        'duration': 1,
        'difficulty': 'ä¸­ç­‰',
        'price_range': [5400, 7200],
        'tags': ['é¯¨é¯Š', 'æ­æ–¯é™¸', 'oslob', 'æœ”æºª', 'åˆºæ¿€', 'ä¸€æ—¥éŠ', 'æ»‘ç´¢', 'kawasan'],
        'highlights': ['é¯¨é¯Šå…±æ¸¸', 'å…¨ç¨‹æœ”æºª', 'é«˜ç©ºæ»‘ç´¢'],
        'best_for': ['æƒ³çœ‹é¯¨é¯Š', 'å–œæ­¡åˆºæ¿€', 'æ™‚é–“æœ‰é™'],
        'departure': '5:30am',
        'content': """ğŸŒŠ ã€S4ã€‘é¯¨é¯Šä¸€æ—¥éŠè¡Œç¨‹

ğŸ“ è¡Œç¨‹æ™¯é»ï¼š
â€¢ æ­æ–¯é™¸é¯¨é¯Šæµ®æ½› Oslob
â€¢ å˜‰è¯å±±å…¨ç¨‹æœ”æºª Kawasanï¼ˆ4-5å°æ™‚ï¼‰
â€¢ å˜‰è¯å±± é«˜ç©ºæ»‘ç´¢+600 php(å‰çœ45åˆ†é˜æ­¥è¡Œ)

ğŸ½ï¸ åŒ…å«é¤é»ï¼šæ—©é¤ã€åˆé¤
â° è¡Œç¨‹å‡ºç™¼æ™‚é–“ï¼š5:30am
âœ¨ å„ªé»ï¼šä¸€æ—¥ç²¾è¯é«”é©—
ğŸ’° è²»ç”¨ï¼š
â€¢ 4-5äººï½œ7,200æŠ«ç´¢/äºº
â€¢ 6-7äººï½œ6,200æŠ«ç´¢/äºº
â€¢ 8-9äººï½œ5,600æŠ«ç´¢/äºº
â€¢ 10-13äººï½œ5,400æŠ«ç´¢/äºº"""
    },
    
    'S4A': {
        'name': 'é¯¨é¯Šä¸€æ—¥éŠï¼ˆè¼•é¬†ç‰ˆï¼‰',
        'type': 'æµ·æ´‹ç”Ÿç‰©',
        'duration': 1,
        'difficulty': 'è¼•é¬†',
        'price_range': [4500, 5800],
        'tags': ['é¯¨é¯Š', 'æ­æ–¯é™¸', 'oslob', 'æœ”æºª', 'è¼•é¬†', 'ä¸€æ—¥éŠ', 'åŠç¨‹', 'alegria'],
        'highlights': ['é¯¨é¯Šå…±æ¸¸', 'åŠç¨‹æœ”æºª'],
        'best_for': ['æƒ³çœ‹é¯¨é¯Šä½†ä¸è¦å¤ªç´¯', 'æ™‚é–“æœ‰é™', 'åˆæ¬¡æœ”æºª'],
        'departure': '5:30am',
        'content': """ğŸ‹ ã€S4Aã€‘é¯¨é¯Šä¸€æ—¥éŠè¡Œç¨‹

ğŸ“ è¡Œç¨‹æ™¯é»ï¼š
â€¢ æ­æ–¯é™¸é¯¨é¯Šæµ®æ½› Oslob
â€¢ AlegriaåŠç¨‹æœ”æºªï¼ˆåŠç¨‹2å°æ™‚ï¼‰

ğŸ½ï¸ åŒ…å«é¤é»ï¼šæ—©é¤ã€åˆé¤
â° è¡Œç¨‹å‡ºç™¼æ™‚é–“ï¼š5:30am
âœ¨ å„ªé»ï¼šè¼ƒè¼•é¬†çš„ä¸€æ—¥éŠ
ğŸ’° è²»ç”¨ï¼š
â€¢ 4-5äººï½œ5,800æŠ«ç´¢/äºº
â€¢ 6-7äººï½œ5,200æŠ«ç´¢/äºº
â€¢ 8-9äººï½œ4,700æŠ«ç´¢/äºº
â€¢ 10-13äººï½œ4,500æŠ«ç´¢/äºº"""
    },
    
    'S5': {
        'name': 'é¯¨é¯Š+è˜‡ç±³é¾å³¶ä¸€æ—¥éŠ',
        'type': 'æµ·æ´‹ç”Ÿç‰©',
        'duration': 1,
        'difficulty': 'è¼•é¬†',
        'price_range': [3900, 6400],
        'tags': ['é¯¨é¯Š', 'æ­æ–¯é™¸', 'oslob', 'è˜‡ç±³é¾å³¶', 'æ•™å ‚', 'æ–‡åŒ–', 'ä¸€æ—¥éŠ', 'æµ·å³¶'],
        'highlights': ['é¯¨é¯Šå…±æ¸¸', 'è˜‡ç±³é¾å³¶æµ®æ½›', 'å–œç‘ªæ‹‰æ•™å ‚'],
        'best_for': ['æƒ³çœ‹é¯¨é¯Š', 'å–œæ­¡æµ·å³¶', 'å°æ–‡åŒ–æ„Ÿèˆˆè¶£'],
        'departure': '5:30am',
        'content': """ğŸï¸ ã€S5ã€‘é¯¨é¯Šä¸€æ—¥éŠè¡Œç¨‹

ğŸ“ è¡Œç¨‹æ™¯é»ï¼š
â€¢ æ­æ–¯é™¸é¯¨é¯Šæµ®æ½› Oslob
â€¢ è˜‡ç±³é¾å³¶æµ®æ½› Sumilon Island
â€¢ å–œç‘ªæ‹‰æ•™å ‚ Simala Church

ğŸ½ï¸ åŒ…å«é¤é»ï¼šæ—©é¤ã€åˆé¤
â° è¡Œç¨‹å‡ºç™¼æ™‚é–“ï¼š5:30am
âœ¨ å„ªé»ï¼šçµåˆæµ·å³¶èˆ‡æ–‡åŒ–é«”é©—
ğŸ’° è²»ç”¨ï¼š
â€¢ 4-5äººï½œ6,400æŠ«ç´¢/äºº
â€¢ 6-7äººï½œ4,900æŠ«ç´¢/äºº
â€¢ 8-9äººï½œ4,200æŠ«ç´¢/äºº
â€¢ 10-13äººï½œ3,900æŠ«ç´¢/äºº"""
    },
    
    'S6': {
        'name': 'é¯¨é¯Š+ç€‘å¸ƒä¸€æ—¥éŠ',
        'type': 'æµ·æ´‹ç”Ÿç‰©',
        'duration': 1,
        'difficulty': 'è¼•é¬†',
        'price_range': [3400, 5200],
        'tags': ['é¯¨é¯Š', 'æ­æ–¯é™¸', 'oslob', 'ç€‘å¸ƒ', 'æ•™å ‚', 'æ–‡åŒ–', 'ä¸€æ—¥éŠ', 'è‡ªç„¶'],
        'highlights': ['é¯¨é¯Šå…±æ¸¸', 'åœ–é¦¬æ´›ç€‘å¸ƒ', 'å–œç‘ªæ‹‰æ•™å ‚'],
        'best_for': ['æƒ³çœ‹é¯¨é¯Š', 'å–œæ­¡ç€‘å¸ƒ', 'å°æ–‡åŒ–æ„Ÿèˆˆè¶£'],
        'departure': '5:30am',
        'content': """ğŸ’§ ã€S6ã€‘é¯¨é¯Šä¸€æ—¥éŠè¡Œç¨‹

ğŸ“ è¡Œç¨‹æ™¯é»ï¼š
â€¢ æ­æ–¯é™¸é¯¨é¯Šæµ®æ½› Oslob
â€¢ åœ–é¦¬æ´›ç€‘å¸ƒ Tumalog Falls
â€¢ å–œç‘ªæ‹‰æ•™å ‚ Simala Church

ğŸ½ï¸ åŒ…å«é¤é»ï¼šæ—©é¤ã€åˆé¤
â° è¡Œç¨‹å‡ºç™¼æ™‚é–“ï¼š5:30am
âœ¨ å„ªé»ï¼šç€‘å¸ƒèˆ‡æ–‡åŒ–çš„çµåˆ
ğŸ’° è²»ç”¨ï¼š
â€¢ 4-5äººï½œ5,200æŠ«ç´¢/äºº
â€¢ 6-7äººï½œ4,200æŠ«ç´¢/äºº
â€¢ 8-9äººï½œ3,500æŠ«ç´¢/äºº
â€¢ 10-13äººï½œ3,400æŠ«ç´¢/äºº"""
    },
    
    'S7': {
        'name': 'é¯¨é¯Š+å¢¨å¯¶ä¸€æ—¥éŠ',
        'type': 'æµ·æ´‹ç”Ÿç‰©',
        'duration': 1,
        'difficulty': 'è¼•é¬†',
        'price_range': [3900, 6400],
        'tags': ['é¯¨é¯Š', 'æ­æ–¯é™¸', 'oslob', 'å¢¨å¯¶', 'æ²™ä¸é­š', 'ä¸€æ—¥éŠ', 'æµ·æ´‹', 'æµ®æ½›'],
        'highlights': ['é¯¨é¯Šå…±æ¸¸', 'æ²™ä¸é­šé¢¨æš´'],
        'best_for': ['æƒ³çœ‹é¯¨é¯Š', 'æƒ³çœ‹æ²™ä¸é­š', 'å–œæ­¡æµ·æ´‹ç”Ÿç‰©'],
        'departure': '5:30am',
        'content': """ğŸŒŠ ã€S7ã€‘é¯¨é¯Šä¸€æ—¥éŠè¡Œç¨‹

ğŸ“ è¡Œç¨‹æ™¯é»ï¼š
â€¢ æ­æ–¯é™¸é¯¨é¯Šæµ®æ½› Oslob
â€¢ å¢¨å¯¶æ²™ä¸é­š Moalboal

ğŸ½ï¸ åŒ…å«é¤é»ï¼šæ—©é¤ã€åˆé¤
â° è¡Œç¨‹å‡ºç™¼æ™‚é–“ï¼š5:30am
âœ¨ å„ªé»ï¼šç¶“å…¸æµ·æ´‹é›™é«”é©—
ğŸ’° è²»ç”¨ï¼š
â€¢ 4-5äººï½œ6,400æŠ«ç´¢/äºº
â€¢ 6-7äººï½œ4,900æŠ«ç´¢/äºº
â€¢ 8-9äººï½œ4,200æŠ«ç´¢/äºº
â€¢ 10-13äººï½œ3,900æŠ«ç´¢/äºº"""
    }
}

# éœ€æ±‚é—œéµå­—å°æ‡‰ï¼ˆæ™ºèƒ½æ¨è–¦ç³»çµ±ï¼‰
NEED_KEYWORDS = {
    # æ´»å‹•é¡å‹
    'è·³å³¶': ['è·³å³¶', 'å³¶å¶¼', 'è³‡ç”Ÿå ‚', 'é¦™è•‰èˆ¹', 'æ‹–å‚˜'],
    'æµ®æ½›': ['æµ®æ½›', 'æ½›æ°´', 'æµ·åº•', 'é­š', 'çŠç‘š'],
    'æœ”æºª': ['æœ”æºª', 'ç€‘å¸ƒ', 'è·³æ°´', 'åˆºæ¿€', 'å†’éšª', 'kawasan', 'alegria'],
    'é¯¨é¯Š': ['é¯¨é¯Š', 'é¯Šé­š', 'oslob', 'æ­æ–¯é™¸'],
    'æ²™ä¸é­š': ['æ²™ä¸é­š', 'é­šç¾¤', 'å¢¨å¯¶', 'moalboal'],
    
    # æ™¯é»é¡å‹
    'æµ·ç˜': ['æµ·ç˜', 'æ²™ç˜', 'æµ·é‚Š', 'æµ·æ´‹', 'æµ·æ°´'],
    'å°å³¶': ['å°å³¶', 'å³¶å¶¼', 'è·³å³¶', 'å–„å¦®å³¶', 'åª½åª½å³¶', 'è–„è·å³¶'],
    'ç€‘å¸ƒ': ['ç€‘å¸ƒ', 'æœ”æºª', 'æ¸…æ°´', 'æ¸¸æ³³'],
    'æ²™æ´²': ['æ²™æ´²', 'ç™½æ²™', 'kalaggaman', 'åª½åª½å³¶'],
    'å±±æ™¯': ['å·§å…‹åŠ›å±±', 'å±±', 'é«˜è™•', 'çœºæœ›'],
    
    # é«”é©—åå¥½
    'åˆºæ¿€': ['åˆºæ¿€', 'å†’éšª', 'æ¥µé™', 'è·³å‚˜', 'æœ”æºª', 'è·³æ°´', 'æ‡¸å´–'],
    'è¼•é¬†': ['è¼•é¬†', 'ä¼‘é–’', 'åº¦å‡', 'æ”¾é¬†', 'æ‚ é–’', 'åŠç¨‹'],
    'æ‹ç…§': ['æ‹ç…§', 'ç¶²ç¾', 'ç¾ç…§', 'æ”å½±', 'ig', 'æ‰“å¡'],
    'æ–‡åŒ–': ['æ–‡åŒ–', 'æ­·å²', 'æ•™å ‚', 'å¤è¹Ÿ', 'å¸‚å€'],
    
    # æ™‚é–“åå¥½
    'ä¸€æ—¥éŠ': ['ä¸€æ—¥', 'ç•¶å¤©', 'ä¸€å¤©', 'å–®æ—¥'],
    'å…©æ—¥éŠ': ['å…©æ—¥', 'éå¤œ', 'å…©å¤©', 'ä½å®¿'],
    
    # é ç®—è€ƒé‡
    'ä¾¿å®œ': ['ä¾¿å®œ', 'çœéŒ¢', 'åˆ’ç®—', 'ç¶“æ¿Ÿ', 'é ç®—'],
    'é«˜æª”': ['é«˜æª”', 'è±ªè¯', 'é ‚ç´š', 'å¥¢è¯'],
    
    # äººæ•¸
    'æƒ…ä¾¶': ['æƒ…ä¾¶', 'å…©äºº', 'æµªæ¼«', 'èœœæœˆ'],
    'æœ‹å‹': ['æœ‹å‹', 'åŒå­¸', 'ä¸€ç¾¤äºº', 'èšæœƒ'],
    'å®¶åº­': ['å®¶åº­', 'è¦ªå­', 'å°å­©', 'é•·è¼©'],
    
    # ç‰¹æ®Šé«”é©—
    'å‹•ç‰©': ['çœ¼é¡çŒ´', 'é¯¨é¯Š', 'æ²™ä¸é­š', 'é•·å°¾é¯Š'],
    'æ°´ä¸Šæ´»å‹•': ['é¦™è•‰èˆ¹', 'æ‹–å‚˜', 'ç¨æœ¨èˆŸ', 'é¢¨å¸†'],
    'æ¥µé™é‹å‹•': ['è·³å‚˜', 'ç©ºä¸­é£›äºº', 'é«˜ç©ºæ»‘ç´¢', 'è¶Šé‡è»Š']
}

# AI å°è©±å¼å®¢æœç³»çµ±
class TravelConcierge:
    def __init__(self):
        self.conversation_starters = [
            "æ‚¨å¥½ï¼æˆ‘æ˜¯æ‚¨çš„å°ˆå±¬æ—…éŠé¡§å• ğŸ˜Š",
            "å—¨ï¼å¾ˆé«˜èˆˆç‚ºæ‚¨æœå‹™ï¼Œè®“æˆ‘å¹«æ‚¨æ‰¾åˆ°å®Œç¾çš„è¡Œç¨‹ âœ¨",
            "æ­¡è¿ï¼æˆ‘ä¾†å¹«æ‚¨æ¨è–¦æœ€é©åˆçš„å®¿éœ§è¡Œç¨‹ ğŸŒ´"
        ]
        
        self.follow_up_questions = {
            'duration': [
                "æ‚¨æ¯”è¼ƒæƒ³è¦ä¸€æ—¥éŠé‚„æ˜¯å…©æ—¥éŠå‘¢ï¼Ÿ",
                "æ™‚é–“ä¸Šæœ‰ä»€éº¼é™åˆ¶å—ï¼Ÿä¸€å¤©æˆ–å…©å¤©éƒ½å¯ä»¥å—ï¼Ÿ"
            ],
            'budget': [
                "é ç®—å¤§æ¦‚æŠ“å¤šå°‘å‘¢ï¼Ÿæˆ‘å€‘æœ‰ä¸åŒåƒ¹ä½çš„é¸æ“‡ ğŸ’°",
                "æƒ³äº†è§£ä¸€ä¸‹æ‚¨çš„é ç®—ç¯„åœï¼Œå¥½ç‚ºæ‚¨æ¨è–¦åˆé©çš„è¡Œç¨‹"
            ],
            'experience': [
                "æ‚¨æ¯”è¼ƒå–œæ­¡åˆºæ¿€å†’éšªé‚„æ˜¯è¼•é¬†åº¦å‡çš„æ„Ÿè¦ºï¼Ÿ",
                "æƒ³è¦ä»€éº¼æ¨£çš„é«”é©—å‘¢ï¼Ÿåˆºæ¿€ä¸€é»é‚„æ˜¯è¼•é¬†ä¸€é»ï¼Ÿ"
            ],
            'interests': [
                "æœ‰ç‰¹åˆ¥æƒ³çœ‹çš„å—ï¼Ÿæ¯”å¦‚é¯¨é¯Šã€æ²™ä¸é­šã€ç€‘å¸ƒï¼Ÿ",
                "å°ä»€éº¼æœ€æ„Ÿèˆˆè¶£ï¼Ÿæµ·æ´‹ç”Ÿç‰©ã€è‡ªç„¶æ™¯è§€ã€é‚„æ˜¯æ–‡åŒ–æ™¯é»ï¼Ÿ"
            ]
        }
    
    def analyze_message(self, message):
        """åˆ†æç”¨æˆ¶è¨Šæ¯æ„åœ–"""
        message = message.lower()
        
        # æª¢æ¸¬æ„åœ–é¡å‹
        intents = {
            'greeting': ['ä½ å¥½', 'hello', 'hi', 'å—¨', 'æ‚¨å¥½'],
            'asking_trip': ['è¡Œç¨‹', 'æ—…éŠ', 'ç©', 'å»å“ª', 'æ¨è–¦', 'æ™¯é»'],
            'whale_shark': ['é¯¨é¯Š', 'é¯Šé­š', 'oslob', 'æ­æ–¯é™¸'],
            'sardines': ['æ²™ä¸é­š', 'é­šç¾¤', 'å¢¨å¯¶', 'moalboal'],
            'adventure': ['åˆºæ¿€', 'å†’éšª', 'æœ”æºª', 'è·³æ°´', 'æ¥µé™'],
            'relaxing': ['è¼•é¬†', 'ä¼‘é–’', 'åº¦å‡', 'æ”¾é¬†', 'æ‚ é–’'],
            'photography': ['æ‹ç…§', 'ç¶²ç¾', 'ç¾ç…§', 'ig', 'æ‰“å¡'],
            'budget': ['ä¾¿å®œ', 'çœéŒ¢', 'é ç®—', 'åƒ¹æ ¼', 'å¤šå°‘éŒ¢'],
            'one_day': ['ä¸€æ—¥', 'ä¸€å¤©', 'ç•¶å¤©', 'å–®æ—¥'],
            'two_day': ['å…©æ—¥', 'å…©å¤©', 'éå¤œ', 'ä½å®¿'],
            'first_time': ['ç¬¬ä¸€æ¬¡', 'åˆæ¬¡', 'æ–°æ‰‹', 'æ²’å»é'],
            'island': ['è·³å³¶', 'å°å³¶', 'å³¶å¶¼', 'è–„è·å³¶', 'å–„å¦®å³¶'],
            'culture': ['æ–‡åŒ–', 'æ­·å²', 'æ•™å ‚', 'å¸‚å€', 'å¤è¹Ÿ'],
            'beach': ['æµ·ç˜', 'æ²™ç˜', 'æµ·é‚Š', 'æ²™æ´²']
        }
        
        detected_intents = []
        for intent, keywords in intents.items():
            if any(keyword in message for keyword in keywords):
                detected_intents.append(intent)
        
        return detected_intents
    
    def analyze_user_needs(self, message):
        """æ•´åˆåŸæœ‰çš„éœ€æ±‚åˆ†æåŠŸèƒ½"""
        message = message.lower()
        matched_needs = []
        
        # åˆ†æç”¨æˆ¶è¨Šæ¯ä¸­çš„éœ€æ±‚é—œéµå­—
        for need_type, keywords in NEED_KEYWORDS.items():
            for keyword in keywords:
                if keyword in message:
                    matched_needs.append(need_type)
                    break
        
        # æ ¹æ“šéœ€æ±‚åŒ¹é…è¡Œç¨‹
        recommendations = []
        
        for code, info in ITINERARY_INFO.items():
            score = 0
            
            # è¨ˆç®—åŒ¹é…åˆ†æ•¸
            for need in matched_needs:
                # æª¢æŸ¥éœ€æ±‚é¡å‹æ˜¯å¦åœ¨æ¨™ç±¤ä¸­
                if need in info['tags']:
                    score += 3
                # æª¢æŸ¥éœ€æ±‚é—œéµå­—æ˜¯å¦åœ¨æ¨™ç±¤ä¸­
                elif any(need_keyword in info['tags'] for need_keyword in NEED_KEYWORDS.get(need, [])):
                    score += 2
            
            # æª¢æŸ¥æ¨™ç±¤æ˜¯å¦ç›´æ¥åŒ¹é…è¨Šæ¯
            for tag in info['tags']:
                if tag in message:
                    score += 1
            
            if score > 0:
                recommendations.append((code, info, score))
        
        # æŒ‰åˆ†æ•¸æ’åº
        recommendations.sort(key=lambda x: x[2], reverse=True)
        
        return recommendations, matched_needs
    
    def generate_personalized_response(self, intents, message):
        """æ ¹æ“šæ„åœ–ç”Ÿæˆå€‹äººåŒ–å›æ‡‰"""
        
        # å¦‚æœåªæ˜¯æ‰“æ‹›å‘¼
        if 'greeting' in intents and len(intents) == 1:
            return self.get_conversation_starter() + "\n\næƒ³å»å®¿éœ§ç©å—ï¼Ÿå‘Šè¨´æˆ‘æ‚¨æƒ³è¦ä»€éº¼æ¨£çš„é«”é©—ï¼Œæˆ‘ä¾†ç‚ºæ‚¨æ¨è–¦æœ€æ£’çš„è¡Œç¨‹ï¼"
        
        # å¦‚æœè©¢å•è¡Œç¨‹ä½†æ²’æœ‰å…·é«”éœ€æ±‚
        if 'asking_trip' in intents and len(intents) == 1:
            return self.get_needs_assessment()
        
        # æ ¹æ“šå…·é«”éœ€æ±‚æ¨è–¦
        recommendations = self.get_recommendations_by_intent(intents)
        
        if recommendations:
            return self.format_recommendations(recommendations, intents)
        else:
            # å¦‚æœAIæ¨è–¦æ²’æœ‰çµæœï¼Œä½¿ç”¨åŸæœ‰çš„æ™ºèƒ½æ¨è–¦ç³»çµ±
            old_recommendations, matched_needs = self.analyze_user_needs(message)
            if old_recommendations:
                return self.generate_recommendation_message(old_recommendations, matched_needs)
            else:
                return self.get_clarification_response(message)
    
    def get_conversation_starter(self):
        return random.choice(self.conversation_starters)
    
    def get_needs_assessment(self):
        return """æˆ‘ä¾†å¹«æ‚¨æ‰¾åˆ°æœ€é©åˆçš„è¡Œç¨‹ï¼è®“æˆ‘äº†è§£ä¸€ä¸‹æ‚¨çš„åå¥½ï¼š

ğŸ¤” æ‚¨æ¯”è¼ƒæƒ³è¦ï¼š
â€¢ ğŸ¦ˆ çœ‹é¯¨é¯Šã€æ²™ä¸é­šç­‰æµ·æ´‹ç”Ÿç‰©ï¼Ÿ
â€¢ ğŸï¸ ç¾éº—æµ·å³¶ã€æ‹ç…§æ‰“å¡ï¼Ÿ
â€¢ ğŸŒŠ åˆºæ¿€å†’éšªã€æœ”æºªè·³æ°´ï¼Ÿ
â€¢ ğŸŒ¸ è¼•é¬†åº¦å‡ã€è‡ªç„¶æ™¯è§€ï¼Ÿ
â€¢ ğŸ›ï¸ æ–‡åŒ–å¤è¹Ÿã€å¸‚å€è§€å…‰ï¼Ÿ

å‘Šè¨´æˆ‘æ‚¨çš„æƒ³æ³•ï¼Œæˆ‘æœƒæ¨è–¦æœ€é©åˆçš„è¡Œç¨‹çµ¦æ‚¨ï¼"""
    
    def get_recommendations_by_intent(self, intents):
        """æ ¹æ“šæ„åœ–æ¨è–¦è¡Œç¨‹"""
        recommendations = []
        
        # é¯¨é¯Šç›¸é—œ
        if 'whale_shark' in intents:
            if 'relaxing' in intents or 'one_day' in intents:
                recommendations.append(('S4A', 3))
                recommendations.append(('S5', 2))
                recommendations.append(('S6', 2))
            elif 'two_day' in intents:
                recommendations.append(('S1', 3))
                recommendations.append(('S1A', 2))
            else:
                recommendations.append(('S1', 3))
                recommendations.append(('S4A', 2))
                recommendations.append(('S4', 2))
        
        # æ²™ä¸é­šç›¸é—œ
        elif 'sardines' in intents:
            recommendations.append(('S8', 3))
            recommendations.append(('S7', 2))
            recommendations.append(('S3', 2))
        
        # å†’éšªåˆºæ¿€
        elif 'adventure' in intents:
            recommendations.append(('S1', 3))
            recommendations.append(('S2', 3))
            recommendations.append(('S4', 2))
        
        # æ‹ç…§ç¶²ç¾
        elif 'photography' in intents:
            recommendations.append(('N3', 3))
            recommendations.append(('N4', 2))
        
        # æµ·ç˜ç›¸é—œ
        elif 'beach' in intents:
            recommendations.append(('N4', 3))
            recommendations.append(('N3', 2))
            recommendations.append(('S8', 2))
        
        # è·³å³¶ç›¸é—œ
        elif 'island' in intents:
            recommendations.append(('C1', 3))
            recommendations.append(('B1', 2))
            recommendations.append(('B2', 2))
        
        # æ–‡åŒ–ç›¸é—œ
        elif 'culture' in intents:
            recommendations.append(('C2', 3))
            recommendations.append(('S5', 2))
            recommendations.append(('S6', 2))
        
        # è¼•é¬†åº¦å‡
        elif 'relaxing' in intents:
            if 'two_day' in intents:
                recommendations.append(('N2', 3))
                recommendations.append(('B2', 2))
            else:
                recommendations.append(('C1', 3))
                recommendations.append(('B1', 2))
                recommendations.append(('C2', 2))
        
        # é ç®—è€ƒé‡
        elif 'budget' in intents:
            recommendations.append(('C2', 3))
            recommendations.append(('S8', 2))
        
        # ç¬¬ä¸€æ¬¡ä¾†
        elif 'first_time' in intents:
            recommendations.append(('C1', 3))
            recommendations.append(('S4A', 2))
            recommendations.append(('B1', 2))
        
        # æ™‚é–“åå¥½
        elif 'one_day' in intents:
            recommendations.extend([('C1', 2), ('B1', 2), ('S4A', 2), ('S8', 2)])
        elif 'two_day' in intents:
            recommendations.extend([('S1', 3), ('N3', 2), ('B2', 2)])
        
        # å¦‚æœæ˜¯ä¸€èˆ¬è©¢å•è¡Œç¨‹
        elif 'asking_trip' in intents:
            recommendations.extend([('S1', 3), ('C1', 2), ('N3', 2)])
        
        return recommendations
    
    def format_recommendations(self, recommendations, intents):
        """æ ¼å¼åŒ–æ¨è–¦å›æ‡‰"""
        if not recommendations:
            return self.get_clarification_response("")
        
        # å–å‰3å€‹æ¨è–¦
        top_recommendations = sorted(recommendations, key=lambda x: x[1], reverse=True)[:3]
        
        response = "æ ¹æ“šæ‚¨çš„éœ€æ±‚ï¼Œæˆ‘ç‚ºæ‚¨æ¨è–¦é€™å¹¾å€‹è¶…æ£’çš„è¡Œç¨‹ï¼š\n\n"
        
        for i, (code, score) in enumerate(top_recommendations, 1):
            itinerary = ITINERARY_INFO[code]
            price_min, price_max = itinerary['price_range']
            
            response += f"ğŸŒŸ **{i}. ã€{code}ã€‘{itinerary['name']}**\n"
            response += f"âœ¨ {itinerary['duration']}æ—¥éŠ | {itinerary['difficulty']} | â‚±{price_min:,}-{price_max:,}\n"
            response += f"ğŸ¯ é©åˆï¼š{' '.join(itinerary['best_for'][:2])}\n"
            response += f"ğŸ“ äº®é»ï¼š{' '.join(itinerary['highlights'][:2])}\n\n"
        
        response += f"ğŸ’¡ ç›´æ¥è¼¸å…¥è¡Œç¨‹ä»£ç¢¼ï¼ˆå¦‚ {top_recommendations[0][0]}ï¼‰æŸ¥çœ‹å®Œæ•´è©³æƒ…\n"
        response += "ğŸ¤” éœ€è¦æ›´å¤šè³‡è¨Šæˆ–å…¶ä»–æ¨è–¦å—ï¼Ÿ"
        
        return response
    
    def generate_recommendation_message(self, recommendations, user_needs):
        """ç”Ÿæˆæ¨è–¦è¨Šæ¯ï¼ˆåŸæœ‰åŠŸèƒ½ï¼‰"""
        if not recommendations:
            return None
        
        if len(recommendations) == 1:
            # åªæœ‰ä¸€å€‹æ¨è–¦
            code, info, score = recommendations[0]
            return f"ğŸ¯ æ ¹æ“šæ‚¨çš„éœ€æ±‚ï¼Œæˆ‘æ¨è–¦ï¼š\n\n{info['content']}"
        
        elif len(recommendations) <= 3:
            # å¤šå€‹æ¨è–¦ï¼Œé¡¯ç¤ºç°¡è¦ä¿¡æ¯
            message = f"ğŸ¯ æ ¹æ“šæ‚¨çš„éœ€æ±‚ï¼Œæˆ‘ç‚ºæ‚¨æ¨è–¦ä»¥ä¸‹ {len(recommendations)} å€‹è¡Œç¨‹ï¼š\n\n"
            
            for i, (code, info, score) in enumerate(recommendations, 1):
                price_min, price_max = info['price_range']
                message += f"{i}. ã€{code}ã€‘{info['name']}\n"
                message += f"   â­ {info['duration']}æ—¥éŠ | â‚±{price_min:,}-{price_max:,}/äºº\n"
                message += f"   ğŸ• å‡ºç™¼æ™‚é–“ï¼š{info['departure']}\n\n"
            
            message += "ğŸ’¡ è¼¸å…¥è¡Œç¨‹ä»£ç¢¼ï¼ˆå¦‚ S1ã€C1ï¼‰æŸ¥çœ‹è©³ç´°è³‡è¨Š"
            return message
        
        else:
            # å¤ªå¤šæ¨è–¦ï¼Œåªé¡¯ç¤ºå‰3å€‹
            message = f"ğŸ¯ æ‰¾åˆ° {len(recommendations)} å€‹ç¬¦åˆçš„è¡Œç¨‹ï¼Œç‚ºæ‚¨æ¨è–¦æœ€åŒ¹é…çš„å‰ 3 å€‹ï¼š\n\n"
            
            for i, (code, info, score) in enumerate(recommendations[:3], 1):
                price_min, price_max = info['price_range']
                message += f"{i}. ã€{code}ã€‘{info['name']}\n"
                message += f"   â­ {info['duration']}æ—¥éŠ | â‚±{price_min:,}-{price_max:,}/äºº\n"
                message += f"   ğŸ• å‡ºç™¼æ™‚é–“ï¼š{info['departure']}\n\n"
            
            message += "ğŸ’¡ è¼¸å…¥è¡Œç¨‹ä»£ç¢¼æŸ¥çœ‹è©³ç´°è³‡è¨Šï¼Œæˆ–å‘Šè¨´æˆ‘æ›´å…·é«”çš„éœ€æ±‚ï¼"
            return message
    
    def get_clarification_response(self, message):
        """ç²å–æ¾„æ¸…å›æ‡‰"""
        clarifications = [
            "è®“æˆ‘æ›´äº†è§£æ‚¨çš„éœ€æ±‚ï¼Œå¥½ç‚ºæ‚¨æ¨è–¦æœ€é©åˆçš„è¡Œç¨‹ï¼",
            "æƒ³å¹«æ‚¨æ‰¾åˆ°å®Œç¾çš„è¡Œç¨‹ï¼Œèƒ½å‘Šè¨´æˆ‘æ›´å¤šæ‚¨çš„æƒ³æ³•å—ï¼Ÿ",
            "æˆ‘æƒ³ç‚ºæ‚¨æ¨è–¦æœ€æ£’çš„é«”é©—ï¼Œå¯ä»¥åˆ†äº«ä¸€ä¸‹æ‚¨çš„åå¥½å—ï¼Ÿ"
        ]
        
        base_response = random.choice(clarifications)
        
        # éš¨æ©Ÿæå‡ºä¸€å€‹è·Ÿé€²å•é¡Œ
        question_type = random.choice(['interests', 'experience', 'duration'])
        follow_up = random.choice(self.follow_up_questions[question_type])
        
        return f"{base_response}\n\n{follow_up}"

# åˆå§‹åŒ– AI å®¢æœ
concierge = TravelConcierge()

# è‡ªå‹•å›è¦†é—œéµå­—å­—å…¸
AUTO_REPLIES = {
    'ä¿éšª': """ğŸ”” é—œæ–¼ä¿éšªçš„èªªæ˜ï¼š

æˆ‘å€‘æ—…éŠè¡Œç¨‹ä¸­æ‰€ä½¿ç”¨çš„è»Šè¼›èˆ‡èˆ¹éš»ï¼Œçš†ç‚ºåˆæ³•ç‡Ÿé‹ä¸¦æœ‰æŠ•ä¿ç›¸é—œè²¬ä»»ä¿éšªï¼Œå› æ­¤åŸºæœ¬çš„è»Šéšªèˆ‡èˆ¹éšªå·²åŒ…å«æ–¼è¡Œç¨‹ä¸­ï¼Œä¿éšœä¹˜å®¢åœ¨äº¤é€šå·¥å…·ä¸Šçš„åŸºæœ¬å®‰å…¨ã€‚

è‡³æ–¼æ•´è¶Ÿè¡Œç¨‹çš„æ—…éŠå¹³å®‰ä¿éšªï¼ˆTravel Insuranceï¼‰ï¼Œé€™éƒ¨åˆ†æ¡å–ã€Œé¸è³¼åˆ¶ã€ã€‚ä¸»è¦åŸå› å¦‚ä¸‹ï¼š

1. å¤–åœ‹æ—…å®¢ä¸€èˆ¬å·²åœ¨æ¯åœ‹æŠ•ä¿æ—…éŠä¿éšªï¼Œä¿éšœç¯„åœèˆ‡ç†è³ é‡‘é¡æ™®éå„ªæ–¼ç•¶åœ°ä¿éšª
2. è‹¥éœ€åœ¨è²å¾‹è³“æŠ•ä¿ç•¶åœ°çš„æ—…éŠéšªï¼Œè¾¦ç†æ™‚é–“é€šå¸¸è¶…éä¸€é€±
3. ç•¶åœ°ä¿éšªçš„ç†è³ é‡‘é¡æ™®éåä½
4. æœ¬å…¬å¸è¡Œç¨‹ä»¥çŸ­æœŸé«˜æ€§åƒ¹æ¯”å¥—è£è¡Œç¨‹ç‚ºä¸»ï¼Œä¸”é è¨‚æ™‚é–“æ™®éè¼ƒçŸ­

ğŸ”” è‹¥æ‚¨å°æ•´è¶Ÿè¡Œç¨‹çš„ä¿éšªä¿éšœç‰¹åˆ¥é‡è¦–ï¼Œæˆ‘å€‘å»ºè­°å¯è€ƒæ…®åŠ è³¼ï¼Œä½†ä¹Ÿæå‰æé†’ï¼Œç•¶åœ°ä¿éšªçš„ä¿éšœé¡åº¦èˆ‡ç†è³ æ¨™æº–ï¼Œèˆ‡å¤šæ•¸åœ‹éš›ä¿å–®å·®ç•°é —å¤§ã€‚""",
    
    'è·³å‚˜': """ğŸª‚ è·³å‚˜æ–¹æ¡ˆèªªæ˜ï¼š

ğŸ”¸ æ¨™æº–æ–¹æ¡ˆï¼ˆSTANDARDï¼‰ï¼šæ¯äºº â‚±24,500
â€¢ é«˜ç©ºè·³å‚˜ï¼ˆæœ€é«˜é” 10,000 è‹±å°ºï¼‰
â€¢ 20 åˆ†é˜è§€å…‰é£›è¡Œ
â€¢ 30â€“40 ç§’è‡ªç”±è½é«”
â€¢ 5â€“7 åˆ†é˜é™è½å‚˜æ»‘ç¿”
â€¢ è·³å‚˜è­‰æ›¸
â€¢ æ‰‹æŒæ”å½±ç…§ç‰‡èˆ‡å½±ç‰‡ï¼ˆHandcamï¼‰
â€¢ å‰ªè¼¯å¾Œå½±ç‰‡

ğŸ”¸ é«˜ç´šæ–¹æ¡ˆï¼ˆPREMIUMï¼‰ï¼šæ¯äºº â‚±35,000
â€¢ é«˜ç©ºè·³å‚˜ï¼ˆæœ€é«˜é” 10,000 è‹±å°ºï¼‰
â€¢ 20 åˆ†é˜è§€å…‰é£›è¡Œ
â€¢ 30â€“40 ç§’è‡ªç”±è½é«”
â€¢ 5â€“7 åˆ†é˜é™è½å‚˜æ»‘ç¿”
â€¢ è·³å‚˜è­‰æ›¸
â€¢ æ‰‹æŒæ”å½±ç…§ç‰‡èˆ‡å½±ç‰‡ï¼ˆHandcamï¼‰
â€¢ ç¬¬ä¸‰ä½æ”å½±å¸«ç©ºæ‹ç…§ç‰‡èˆ‡å½±ç‰‡ï¼ˆå¤–éƒ¨æ”å½±ï¼‰
â€¢ å‰ªè¼¯å¾Œå½±ç‰‡""",
    
    'ä¼´æ‰‹ç¦®': """ğŸ›ï¸ ä¼´æ‰‹ç¦®/é¤…ä¹¾/é›¶é£Ÿè¨‚è³¼ï¼š

æ»¿ 10åŒ… é€è²¨åˆ°é£¯åº—/å­¸æ ¡
é€šå¸¸é€±å››ç‚ºé…é€æ—¥
æ™‚é–“ç‚ºæ™šä¸Š18:00-22:00

è«‹é»æ“Šä¸‹æ–¹é€£çµï¼Œå¡«å¯«è¨‚å–®ï¼Œå¡«å¯«å®Œæˆå¾Œè«‹å‹™å¿…å›è¦†ï¼š
https://forms.gle/HJKc1nDE9MNRfrp39""",
    
    'é¤…ä¹¾': """ğŸ›ï¸ ä¼´æ‰‹ç¦®/é¤…ä¹¾/é›¶é£Ÿè¨‚è³¼ï¼š

æ»¿ 10åŒ… é€è²¨åˆ°é£¯åº—/å­¸æ ¡
é€šå¸¸é€±å››ç‚ºé…é€æ—¥
æ™‚é–“ç‚ºæ™šä¸Š18:00-22:00

è«‹é»æ“Šä¸‹æ–¹é€£çµï¼Œå¡«å¯«è¨‚å–®ï¼Œå¡«å¯«å®Œæˆå¾Œè«‹å‹™å¿…å›è¦†ï¼š
https://forms.gle/HJKc1nDE9MNRfrp39""",
    
    'é›¶é£Ÿ': """ğŸ›ï¸ ä¼´æ‰‹ç¦®/é¤…ä¹¾/é›¶é£Ÿè¨‚è³¼ï¼š

æ»¿ 10åŒ… é€è²¨åˆ°é£¯åº—/å­¸æ ¡
é€šå¸¸é€±å››ç‚ºé…é€æ—¥
æ™‚é–“ç‚ºæ™šä¸Š18:00-22:00

è«‹é»æ“Šä¸‹æ–¹é€£çµï¼Œå¡«å¯«è¨‚å–®ï¼Œå¡«å¯«å®Œæˆå¾Œè«‹å‹™å¿…å›è¦†ï¼š
https://forms.gle/HJKc1nDE9MNRfrp39""",
    
    'æ‹¼åœ˜': """ğŸŒ´ æ‹¼åœ˜æ´»å‹•èªªæ˜ï¼š

ğŸ”¸ è‡ªçµ„åœ˜è¡Œç¨‹
â€¢ æ‚¨å¯è‡ªç”±é¸æ“‡å‡ºç™¼æ—¥æœŸèˆ‡è¡Œç¨‹ï¼Œæ—…è²»å°‡ä¾å‡ºåœ˜äººæ•¸é€²è¡Œè¨ˆç®—
â€¢ æƒ³è¦æ“æœ‰å°ˆå±¬è¡Œç¨‹çš„å½ˆæ€§ï¼Œè‡ªçµ„åœ˜æ˜¯æœ€ä½³é¸æ“‡ï¼

ğŸ”¸ æ‹¼åœ˜æ´»å‹•
â€¢ è‹¥äººæ•¸ä¸è¶³æˆ–å¸Œæœ›æ—…è²»æ›´å¯¦æƒ ï¼Œæ­¡è¿åƒåŠ æ‹¼åœ˜æ´»å‹•ï¼
â€¢ æ‹¼åœ˜æ´»å‹•çš†ç”±éŠå­¸ä»£è¾¦ä¸­å¿ƒæ¯é€±å›ºå®šæ–¼é€±æœ«èˆ‰è¾¦ï¼Œæä¾›é«˜å“è³ªæ—…éŠé«”é©—
â€¢ ç²å–è³‡è¨Šï¼šå°è©±æ¡†è¼¸å…¥joinerï¼Œä¸¦é»æ“Šé€£çµå ±åï¼""",
    
    'ä¿¡ç”¨å¡': """ğŸ’³ ä¿¡ç”¨å¡ä»˜æ¬¾èªªæ˜ï¼š

æˆ‘å€‘æ¥å—ä¿¡ç”¨å¡ä»˜æ¬¾ï¼Œä½†æ˜¯è¦åŠ ç¸½é‡‘é¡5%çš„ç¨…æ”¶

è«‹æä¾›ä»¥ä¸‹è³‡è¨Šï¼Œæˆ‘å€‘å°‡å¯„é€ä»˜æ¬¾é€£çµè‡³æ‚¨çš„ä¿¡ç®±ï¼š
â€¢ è‹±æ–‡è­·ç…§å…¨åï¼š
â€¢ é›»å­ä¿¡ç®±ï¼š
â€¢ å¸³å–®åœ°å€ï¼ˆè‹±æ–‡ï¼‰ï¼š
â€¢ éƒµéå€è™Ÿï¼š""",
    
    'åˆ·å¡': """ğŸ’³ ä¿¡ç”¨å¡ä»˜æ¬¾èªªæ˜ï¼š

æˆ‘å€‘æ¥å—ä¿¡ç”¨å¡ä»˜æ¬¾ï¼Œä½†æ˜¯è¦åŠ ç¸½é‡‘é¡5%çš„ç¨…æ”¶

è«‹æä¾›ä»¥ä¸‹è³‡è¨Šï¼Œæˆ‘å€‘å°‡å¯„é€ä»˜æ¬¾é€£çµè‡³æ‚¨çš„ä¿¡ç®±ï¼š
â€¢ è‹±æ–‡è­·ç…§å…¨åï¼š
â€¢ é›»å­ä¿¡ç®±ï¼š
â€¢ å¸³å–®åœ°å€ï¼ˆè‹±æ–‡ï¼‰ï¼š
â€¢ éƒµéå€è™Ÿï¼š""",
    
    'äººæ•¸': """ğŸš åœ˜é«”äººæ•¸èˆ‡è»Šè¼›å®‰æ’èªªæ˜ï¼š

æ¯åœ˜æœ€å¤šä»¥ 13 äººç‚ºä¸Šé™ï¼Œå¦‚è¶…é 13 äººï¼Œå°‡æœƒä¾ç…§æƒ…æ³åˆ†æˆå…©åœ˜ï¼ˆå®‰æ’å…©å°è»Šï¼‰ã€‚

ç‚ºä½¿è¡Œç¨‹é †æš¢ï¼Œäººæ•¸åˆ†é…å°‡å¹³å‡åˆ†é…è‡³å…©åœ˜ï¼Œä¸¦ä¸”ä¾æ“šåˆ†åœ˜å¾Œçš„å¯¦éš›äººæ•¸è¨ˆç®—è²»ç”¨ã€‚

ğŸ“Œ ä¾‹å¦‚ï¼š
è‹¥å…±æœ‰ 16 ä½æ—…å®¢ï¼Œå°‡åˆ†ç‚º 2 åœ˜ï¼Œæ¯åœ˜ 8 äººï¼Œ
å‰‡è²»ç”¨å°‡ä»¥ã€Œ8 äººåœ˜ã€çš„åƒ¹æ ¼è¨ˆç®—ã€‚""",
    
    'å®¢è£½åŒ–': """ğŸ—ºï¸ å®¢è£½åŒ–è¡Œç¨‹å®‰æ’ï¼š

å“ˆå›‰ï½å†éº»ç…©å¹«æˆ‘åŠ é€™å€‹å¸³è™Ÿï¼Œæœƒæœ‰å°ˆäººå”åŠ©æ‚¨å®‰æ’è‡ªç”±è¡Œå®¢è£½åŒ–æ—…éŠ

Line : https://lin.ee/83r5zlu""",
    
    'è‡ªç”±è¡Œ': """ğŸ—ºï¸ å®¢è£½åŒ–è¡Œç¨‹å®‰æ’ï¼š

å“ˆå›‰ï½å†éº»ç…©å¹«æˆ‘åŠ é€™å€‹å¸³è™Ÿï¼Œæœƒæœ‰å°ˆäººå”åŠ©æ‚¨å®‰æ’è‡ªç”±è¡Œå®¢è£½åŒ–æ—…éŠ

Line : https://lin.ee/83r5zlu""",
    
    'å°éŠ': """ğŸ‘¨â€ğŸ« å°éŠèªªæ˜ï¼š

æˆ‘å€‘é€™é‚Šçš„å°éŠéƒ½æ˜¯è²å¾‹è³“ç•¶åœ°çš„è‹±æ–‡å°éŠï¼Œè‹±æ–‡æµåˆ©åˆå¥½æºé€šï¼Œä¹Ÿå¾ˆäº†è§£ç•¶åœ°æ–‡åŒ–å’Œå„å¤§æ™¯é»çš„æ•…äº‹ï¼Œå¸¶åœ˜éå¸¸æœ‰ç¶“é©—ï¼âœ¨

å¹¾å€‹å„ªé»åˆ†äº«çµ¦æ‚¨ï¼š
1. è‹±æ–‡æ¸…æ¥šå¥½æ‡‚ï¼šè‹±æ–‡æ˜¯ä»–å€‘çš„æ—¥å¸¸èªè¨€ï¼Œè¬›è©±æ¨™æº–åˆè¦ªåˆ‡ ğŸ—£
2. å¾ˆæ‡‚æœ¬åœ°æ–‡åŒ–ï¼šæœƒä»‹ç´¹ä¸€äº›ä¸åœ¨æ—…éŠæ›¸ä¸Šçš„åœ¨åœ°å°çŸ¥è­˜ ğŸŒ´ğŸ“š
3. è¶…å¥½åˆæœƒå¸¶æ°£æ°›ï¼šå¤§å¤šæ•¸å°éŠéƒ½å¾ˆç†±æƒ…ã€å¥è«‡ ğŸ˜ŠğŸ‰
4. ç¶“é©—è±å¯Œï¼šæˆ‘å€‘é…åˆçš„å°éŠéƒ½å¸¶éå¾ˆå¤šåœ˜ï¼Œè™•ç†å„ç¨®ç‹€æ³éƒ½å¾ˆæœ‰æ–¹æ³• âœ”ğŸ§³

å¦‚æœæ‚¨æœ‰æŒ‡å®šè¦ä¸­æ–‡å°éŠï¼Œæˆ‘å€‘ä¹Ÿå¯ä»¥å¹«æ‚¨å®‰æ’ï¼Œä¸éä¸­æ–‡å°éŠæ¯å¤©æœƒå¤šæ”¶ â‚±4000 çš„è²»ç”¨å“¦ï½""",
    
    'é€€è²»': """ğŸ’° é€€è²»è¦å®šï¼š

ä¸€ã€æ´»å‹•å°šæœªå‡ºç™¼ ğŸš«
ğŸ”¸ å› å¤©å€™å› ç´ å–æ¶ˆï¼ˆæµ·ä¸Šæˆ–é™¸ä¸Šè­¦å ±ï¼‰
â†’ å…¨é¡é€€é‚„è¨‚é‡‘ âœ…

ğŸ”¸ ç„¡å¤©å€™è­¦å ±ï¼Œå®¢äººä¸»å‹•å–æ¶ˆ
â†’ æ‰£é™¤å·²æ”¯ä»˜çš„é£¯åº—æˆ–èˆ¹ç¥¨è²»ç”¨å¾Œï¼Œé€€é‚„å‰©é¤˜è¨‚é‡‘ï¼ˆé€šå¸¸å¹¾ä¹ç„¡æ³•é€€æ¬¾ï¼‰âš 

äºŒã€æ´»å‹•å·²å‡ºç™¼ ğŸš¶ğŸš¢
ğŸ”¸ å› ç‰¹æ®ŠåŸå› ç„¡æ³•åƒåŠ éƒ¨åˆ†æ™¯é»æ´»å‹•
â†’ é€€é‚„è©²æ™¯é»é–€ç¥¨è²»ç”¨ ğŸ’³
ä¾‹å¦‚ï¼šè‹¥å—æ–¹è¡Œç¨‹ç„¡æ³•è§€è³æ²™ä¸é­šï¼Œå°‡é€€é‚„é–€ç¥¨è²»500 PHP ğŸŸ

â— é‡è¦æé†’
è‹¥ç„¡æ³•æ¥å—ä¸Šè¿°é€€è²»è¦å®šï¼Œè«‹å‹¿å ±å âœ‹
è«‹å‹™å¿…å‘ŠçŸ¥åŒåœ˜æˆå“¡ï¼Œé¿å…çˆ­è­° ğŸ—£""",
    
    'å¤©æ°£': """ğŸ’° é€€è²»è¦å®šï¼š

ä¸€ã€æ´»å‹•å°šæœªå‡ºç™¼ ğŸš«
ğŸ”¸ å› å¤©å€™å› ç´ å–æ¶ˆï¼ˆæµ·ä¸Šæˆ–é™¸ä¸Šè­¦å ±ï¼‰
â†’ å…¨é¡é€€é‚„è¨‚é‡‘ âœ…

ğŸ”¸ ç„¡å¤©å€™è­¦å ±ï¼Œå®¢äººä¸»å‹•å–æ¶ˆ
â†’ æ‰£é™¤å·²æ”¯ä»˜çš„é£¯åº—æˆ–èˆ¹ç¥¨è²»ç”¨å¾Œï¼Œé€€é‚„å‰©é¤˜è¨‚é‡‘ï¼ˆé€šå¸¸å¹¾ä¹ç„¡æ³•é€€æ¬¾ï¼‰âš 

äºŒã€æ´»å‹•å·²å‡ºç™¼ ğŸš¶ğŸš¢
ğŸ”¸ å› ç‰¹æ®ŠåŸå› ç„¡æ³•åƒåŠ éƒ¨åˆ†æ™¯é»æ´»å‹•
â†’ é€€é‚„è©²æ™¯é»é–€ç¥¨è²»ç”¨ ğŸ’³
ä¾‹å¦‚ï¼šè‹¥å—æ–¹è¡Œç¨‹ç„¡æ³•è§€è³æ²™ä¸é­šï¼Œå°‡é€€é‚„é–€ç¥¨è²»500 PHP ğŸŸ

â— é‡è¦æé†’
è‹¥ç„¡æ³•æ¥å—ä¸Šè¿°é€€è²»è¦å®šï¼Œè«‹å‹¿å ±å âœ‹
è«‹å‹™å¿…å‘ŠçŸ¥åŒåœ˜æˆå“¡ï¼Œé¿å…çˆ­è­° ğŸ—£""",
    
    'æˆ¿é–“': """ğŸ¨ æˆ¿é–“åˆ†é…èªªæ˜ï¼š

åŸºæœ¬ä¸Šæˆ‘å€‘2-3äºº/é–“æˆ¿ï¼Œç”·å¥³åˆ†æˆ¿ã€‚

å€˜è‹¥æœ‰æƒ…ä¾¶æˆ–è€…å®¶åº­æˆå“¡è¦ä¸€èµ·ä½çš„è©±ï¼Œè«‹å‹™å¿…ç‰¹åˆ¥ææ—©å‘ŠçŸ¥ï¼Œé€™æ¨£æ‰æ–¹ä¾¿å…ˆå¹«æ‚¨å€‘å®‰æ’ã€‚

é£¯åº—ä¹Ÿç„¡æ³•ä¿è­‰å…¨éƒ¨æˆ¿å‹æ¯å€‹äººéƒ½æœ‰å–®äººæˆ¿å¯ä»¥ç¡ï¼Œæœ‰æ™‚å€™æœƒæ˜¯å¤§åºŠæˆ¿ã€‚""",
    
    'ä½å®¿': """ğŸ¨ æˆ¿é–“åˆ†é…èªªæ˜ï¼š

åŸºæœ¬ä¸Šæˆ‘å€‘2-3äºº/é–“æˆ¿ï¼Œç”·å¥³åˆ†æˆ¿ã€‚

å€˜è‹¥æœ‰æƒ…ä¾¶æˆ–è€…å®¶åº­æˆå“¡è¦ä¸€èµ·ä½çš„è©±ï¼Œè«‹å‹™å¿…ç‰¹åˆ¥ææ—©å‘ŠçŸ¥ï¼Œé€™æ¨£æ‰æ–¹ä¾¿å…ˆå¹«æ‚¨å€‘å®‰æ’ã€‚

é£¯åº—ä¹Ÿç„¡æ³•ä¿è­‰å…¨éƒ¨æˆ¿å‹æ¯å€‹äººéƒ½æœ‰å–®äººæˆ¿å¯ä»¥ç¡ï¼Œæœ‰æ™‚å€™æœƒæ˜¯å¤§åºŠæˆ¿ã€‚"""
}

# Webhook å…¥å£
@app.route("/callback", methods=['POST'])
def callback():
    signature = request.headers['X-Line-Signature']
    body = request.get_data(as_text=True)
    print("Received webhook:", body)
    try:
        handler.handle(body, signature)
    except InvalidSignatureError:
        abort(400)
    return 'OK'

# æˆå“¡åŠ å…¥äº‹ä»¶è™•ç†
@handler.add(MemberJoinedEvent)
def handle_member_joined(event):
    global last_welcome_time
    now = time.time()
    if now - last_welcome_time < WELCOME_COOLDOWN:
        print("Skip sending welcome message due to cooldown.")
        return

    welcome_text = """ğŸ‰ æ­¡è¿åŠ å…¥ã€Šæ¾³è²å®¢éŠå­¸ï½œå‡ºéŠç¾¤çµ„ã€‹ ğŸ‰

å—¨å—¨ï½æ­¡è¿æ–°æœ‹å‹åŠ å…¥æˆ‘å€‘çš„å‡ºéŠç¾¤çµ„ ğŸ‘‹
ç‚ºäº†è®“æ´»å‹•å®‰æ’æ›´é †åˆ©ï¼Œè«‹æ–°åŠ å…¥çš„æœ‹å‹å‹™å¿…å®Œæˆå ±åˆ°æ‰‹çºŒï¼

âœ… è«‹åˆ°ã€è¨˜äº‹æœ¬ã€‘ç•™è¨€å ±åˆ°
â¡ï¸ å¯«ä¸Šä»¥ä¸‹è³‡è¨Šï¼š

ä¸­æ–‡åå­—ï¼è‹±æ–‡è­·ç…§åï¼æ€§åˆ¥ï¼èªè¨€å­¸æ ¡
ï¼ˆç¯„ä¾‹ï¼šç‹å°æ˜ï¼Wang Shaw Mingï¼ç”·ï¼Fella2ï¼‰

âš ï¸ æ²’æœ‰ç•™è¨€å ±åˆ°çš„åŒå­¸ï¼Œå°‡ä¸æœƒåˆ—å…¥å‡ºéŠåå–®è¨ˆç®—å–”ï¼

ğŸ’µ è¨‚é‡‘æé†’
æˆ‘å€‘å°‡æ–¼é€±å››æ™šä¸Š 18:30 è‡³ 22:00 æ´¾å“¡å·¥åˆ°å„èªè¨€å­¸æ ¡é–€å£æ”¶å–è¨‚é‡‘ï¼ˆç¾é‡‘ä»˜æ¬¾ï¼‰ã€‚
è«‹æº–æ™‚å‡ºç¾ä¸¦æº–å‚™å¥½æ­£ç¢ºé‡‘é¡ï¼Œæ„Ÿè¬é…åˆï¼

ğŸ¤– æˆ‘æ˜¯æ‚¨çš„æ™ºèƒ½æ—…éŠé¡§å•ï¼
åªè¦å‘Šè¨´æˆ‘æ‚¨æƒ³è¦ä»€éº¼æ¨£çš„é«”é©—ï¼Œæˆ‘å°±èƒ½ç‚ºæ‚¨æ¨è–¦æœ€é©åˆçš„è¡Œç¨‹ âœ¨
ä¾‹å¦‚ï¼šã€Œæƒ³è¦åˆºæ¿€çš„å†’éšªã€ã€ã€Œæƒ³çœ‹é¯¨é¯Šã€ã€ã€Œé©åˆæ‹ç…§çš„åœ°æ–¹ã€
"""
    line_bot_api.reply_message(event.reply_token, TextSendMessage(text=welcome_text))
    last_welcome_time = now

# ä¸»è¦è¨Šæ¯è™•ç† - æ•´åˆAIå°è©±å¼å®¢æœå’Œæ™ºèƒ½æ¨è–¦
@handler.add(MessageEvent, message=TextMessage)
def handle_message(event):
    if event.source.type == 'group':
        print("Current Group ID:", event.source.group_id)
    
    user_message = event.message.text.strip()
    user_message_lower = user_message.lower()
    
    # 1. æª¢æŸ¥ç²¾ç¢ºçš„è¡Œç¨‹ä»£ç¢¼
    sorted_codes = sorted(ITINERARY_INFO.items(), key=lambda x: len(x[0]), reverse=True)
    for code, info in sorted_codes:
        if code.lower() == user_message_lower or code.lower() in user_message_lower.split():
            line_bot_api.reply_message(
                event.reply_token, 
                TextSendMessage(text=info['content'])
            )
            print(f"Auto-replied for exact itinerary code: {code}")
            return
    
    # 2. æª¢æŸ¥è‡ªå‹•å›è¦†é—œéµå­—
    for keyword, reply in AUTO_REPLIES.items():
        if keyword in user_message_lower:
            line_bot_api.reply_message(
                event.reply_token, 
                TextSendMessage(text=reply)
            )
            print(f"Auto-replied for keyword: {keyword}")
            return
    
    # 3. ç‰¹æ®ŠæŒ‡ä»¤è™•ç†
    if 'joiner' in user_message_lower:
        joiner_reply = """ğŸ”¥ iOutback Agency æ¾³è²å®¢éŠå­¸ é€±æœ«æ‹¼åœ˜æ´»å‹• ğŸ”¥
ğŸ“Œ å ±åå‚³é€é–€ ğŸ‘‰ https://forms.gle/3pxQ9kjZMHZJQXd67"""
        line_bot_api.reply_message(
            event.reply_token, 
            TextSendMessage(text=joiner_reply)
        )
        print("Replied to joiner command")
        return
    
    # 4. AI å°è©±å¼å®¢æœè™•ç†
    try:
        # åˆ†æç”¨æˆ¶æ„åœ–
        intents = concierge.analyze_message(user_message)
        print(f"Detected intents: {intents}")
        
        # ç”Ÿæˆå€‹äººåŒ–å›æ‡‰
        ai_response = concierge.generate_personalized_response(intents, user_message)
        
        if ai_response:
            line_bot_api.reply_message(
                event.reply_token,
                TextSendMessage(text=ai_response)
            )
            print(f"AI response sent for intents: {intents}")
            return
            
    except Exception as e:
        print(f"AI processing error: {e}")
    
    # 5. å¦‚æœæ˜¯ç–‘å•å¥æˆ–æ±‚åŠ©ï¼Œæä¾›å¼•å°
    question_indicators = ['ä»€éº¼', 'æ€éº¼', 'å¦‚ä½•', 'æ¨è–¦', 'å»ºè­°', 'æƒ³è¦', 'æƒ³å»', 'æœ‰æ²’æœ‰', '?', 'ï¼Ÿ']
    if any(indicator in user_message for indicator in question_indicators):
        help_message = """ğŸ¤” æˆ‘å¯ä»¥å¹«æ‚¨æ¨è–¦æœ€é©åˆçš„æ—…éŠè¡Œç¨‹ï¼

è«‹å‘Šè¨´æˆ‘æ‚¨çš„åå¥½ï¼Œä¾‹å¦‚ï¼š
ğŸï¸ æƒ³è¦ä»€éº¼é«”é©—ï¼šã€Œåˆºæ¿€å†’éšªã€ã€ã€Œè¼•é¬†åº¦å‡ã€ã€ã€Œæ‹ç…§æ‰“å¡ã€
ğŸ‹ æƒ³çœ‹ä»€éº¼ï¼šã€Œé¯¨é¯Šã€ã€ã€Œæ²™ä¸é­šã€ã€ã€Œç€‘å¸ƒã€ã€ã€Œæµ·ç˜ã€
â° æ™‚é–“åå¥½ï¼šã€Œä¸€æ—¥éŠã€ã€ã€Œå…©æ—¥éŠã€
ğŸ’° é ç®—è€ƒé‡ï¼šã€Œä¾¿å®œä¸€é»ã€ã€ã€Œä¸è€ƒæ…®é ç®—ã€

æˆ–è€…ç›´æ¥è¼¸å…¥è¡Œç¨‹ä»£ç¢¼ï¼ˆå¦‚ S1ã€C1ã€N3ï¼‰æŸ¥çœ‹è©³ç´°è³‡è¨Šï¼"""
        
        line_bot_api.reply_message(
            event.reply_token,
            TextSendMessage(text=help_message)
        )
        print("Sent guidance message")
        return
    
    # 6. å…œåº•å›æ‡‰ - æ™ºèƒ½å®¢æœé¢¨æ ¼
    fallback_response = """æˆ‘æ˜¯æ‚¨çš„æ—…éŠé¡§å•ï¼Œå¾ˆæ¨‚æ„ç‚ºæ‚¨æ¨è–¦è¡Œç¨‹ï¼ğŸ˜Š

ğŸŒŸ æ‚¨å¯ä»¥å‘Šè¨´æˆ‘ï¼š
â€¢ æƒ³çœ‹é¯¨é¯Š ğŸ¦ˆ
â€¢ æƒ³è¦åˆºæ¿€å†’éšª ğŸŒŠ
â€¢ æƒ³æ‹ç¾ç…§ ğŸ“¸
â€¢ æƒ³è¼•é¬†åº¦å‡ ğŸï¸
â€¢ é ç®—æœ‰é™ ğŸ’°

æˆ–è€…ç›´æ¥å•æˆ‘ã€Œæœ‰ä»€éº¼æ¨è–¦çš„è¡Œç¨‹å—ï¼Ÿã€

æˆ‘æœƒæ ¹æ“šæ‚¨çš„éœ€æ±‚æ¨è–¦æœ€é©åˆçš„å®¿éœ§è¡Œç¨‹ï¼"""
    
    line_bot_api.reply_message(
        event.reply_token,
        TextSendMessage(text=fallback_response)
    )
    print("Sent fallback AI response")

if __name__ == "__main__":
    app.run(host="0.0.0.0", port=5001)

# æ•´åˆç‰ˆèªªæ˜ï¼š
# é€™æ˜¯ä¸€å€‹å®Œæ•´çš„æ™ºèƒ½æ—…éŠå®¢æœ LINE Botï¼Œæ•´åˆäº†å…©å€‹ç‰ˆæœ¬çš„æ‰€æœ‰åŠŸèƒ½ï¼š
# 
# ğŸ¤– æ ¸å¿ƒåŠŸèƒ½ï¼š
# 1. å®Œæ•´è¡Œç¨‹è³‡æ–™åº«ï¼ˆ18å€‹è¡Œç¨‹ä»£ç¢¼ï¼ŒåŒ…å«æ‰€æœ‰è©³ç´°è³‡è¨Šï¼‰
# 2. AI å°è©±å¼å®¢æœï¼ˆç†è§£è‡ªç„¶èªè¨€ï¼Œå€‹äººåŒ–æ¨è–¦ï¼‰
# 3. æ™ºèƒ½éœ€æ±‚åˆ†æï¼ˆé—œéµå­—åŒ¹é…ï¼Œç²¾æº–æ¨è–¦ï¼‰
# 4. è‡ªå‹•å›è¦†ç³»çµ±ï¼ˆä¿éšªã€è·³å‚˜ã€ä¼´æ‰‹ç¦®ç­‰å¸¸è¦‹å•é¡Œï¼‰
# 5. è¡Œç¨‹ä»£ç¢¼æŸ¥è©¢ï¼ˆè¼¸å…¥ä»£ç¢¼ç›´æ¥æŸ¥çœ‹è©³ç´°è³‡è¨Šï¼‰
# 6. æ–°æˆå“¡æ­¡è¿ï¼ˆå«æ™ºèƒ½åŠŸèƒ½ä»‹ç´¹ï¼‰
# 7. æ‹¼åœ˜æ´»å‹•é€£çµï¼ˆjoiner æŒ‡ä»¤ï¼‰
# 8. æ™ºèƒ½å¼•å°ç³»çµ±ï¼ˆå¹«åŠ©ç”¨æˆ¶æ›´å¥½è¡¨é”éœ€æ±‚ï¼‰
# 
# ğŸ¯ ä½¿ç”¨æ–¹å¼ï¼š
# - è‡ªç„¶å°è©±ï¼šã€Œæˆ‘æƒ³çœ‹é¯¨é¯Šã€ã€ã€Œæœ‰ä»€éº¼åˆºæ¿€çš„è¡Œç¨‹ã€
# - è¡Œç¨‹ä»£ç¢¼ï¼šè¼¸å…¥ S1ã€C1ã€N3 ç­‰æŸ¥çœ‹è©³ç´°è³‡è¨Š
# - é—œéµå­—æŸ¥è©¢ï¼šä¿éšªã€è·³å‚˜ã€å°éŠç­‰
# - æ‹¼åœ˜å ±åï¼šè¼¸å…¥ joiner ç²å–å ±åé€£çµ
# 
# ğŸ”„ è™•ç†æµç¨‹ï¼š
# 1. ç²¾ç¢ºè¡Œç¨‹ä»£ç¢¼åŒ¹é… â†’ ç›´æ¥é¡¯ç¤ºè¡Œç¨‹è©³æƒ…
# 2. é—œéµå­—è‡ªå‹•å›è¦† â†’ é¡¯ç¤ºç›¸é—œèªªæ˜
# 3. AI æ„åœ–åˆ†æ â†’ å€‹äººåŒ–æ¨è–¦
# 4. æ™ºèƒ½éœ€æ±‚åŒ¹é… â†’ åŸºæ–¼æ¨™ç±¤æ¨è–¦
# 5. ç–‘å•å¼•å° â†’ æä¾›ä½¿ç”¨æŒ‡å¼•
# 6. å…œåº•å›æ‡‰ â†’ ç¢ºä¿å§‹çµ‚æœ‰æœ‰ç”¨å›è¦†
# 
# é€™å€‹æ•´åˆç‰ˆæœ¬çµåˆäº†å…©å€‹ç‰ˆæœ¬çš„å„ªé»ï¼Œæä¾›æ›´æ™ºèƒ½ã€æ›´äººæ€§åŒ–çš„å®¢æœé«”é©—ï¼

# ğŸ”¸ æ‹¼åœ˜æ´»å‹•
# â€¢ è‹¥äººæ•¸ä¸è¶³æˆ–å¸Œæœ›æ—…è²»æ›´å¯¦æƒ ï¼Œæ­¡è¿åƒåŠ æ‹¼åœ˜æ´»å‹•ï¼
# â€¢ æ‹¼åœ˜æ´»å‹•çš†ç”±éŠå­¸ä»£è¾¦ä¸­å¿ƒæ¯é€±å›ºå®šæ–¼é€±æœ«èˆ‰è¾¦ï¼Œæä¾›é«˜å“è³ªæ—…éŠé«”é©—
# â€¢ ç²å–è³‡è¨Šï¼šå°è©±æ¡†è¼¸å…¥joinerï¼Œä¸¦é»æ“Šé€£çµå ±åï¼""",
    
#     'å ±å': """ğŸŒ´ æ‹¼åœ˜æ´»å‹•èªªæ˜ï¼š

# ğŸ”¸ è‡ªçµ„åœ˜è¡Œç¨‹
# â€¢ æ‚¨å¯è‡ªç”±é¸æ“‡å‡ºç™¼æ—¥æœŸèˆ‡è¡Œç¨‹ï¼Œæ—…è²»å°‡ä¾å‡ºåœ˜äººæ•¸é€²è¡Œè¨ˆç®—
# â€¢ æƒ³è¦æ“æœ‰å°ˆå±¬è¡Œç¨‹çš„å½ˆæ€§ï¼Œè‡ªçµ„åœ˜æ˜¯æœ€ä½³é¸æ“‡ï¼